<!doctype html>
<html lang="fr">
<head>
<meta name="theme-color" content="#000000" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#000000" media="(prefers-color-scheme: dark)">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Les Traîtres — 40 ans Franck</title>
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700;900&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
<style>
:root{--fg:#fff;--mut:#cfd5dc;--per:6s;--count:15;--total:calc((var(--per) + 5s)*var(--count) + 0.5s)}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:'Playfair Display',serif;color:var(--fg);background:#000}

/* Fallback si image manquante */
.bg-fallback{background:radial-gradient(ellipse at center,#0a0d12 0%,#05070b 60%,#000 100%)}

/* Arrière-plans */
.bg-gate,.bg-intro{
  position:fixed; inset:0;
  background-size:cover; background-position:center;
  z-index:0; 
  opacity:1; transition:opacity 1200ms ease; will-change:opacity;
}
.bg-gate{ background-image:url('photo1.jpg'); }
.bg-intro{ background-image:url('chateau.jpg'); opacity:0; }
.intro-started .bg-gate{ opacity:0; }
.intro-started .bg-intro{ opacity:1; }
/* 3e fond : écran joueur */
.bg-role{
  position:fixed; inset:0;
  background:none center/cover no-repeat;
  z-index:0; display:none; 
}
.player-focus .bg-role{ display:block; }
.player-focus .bg-gate, .player-focus .bg-intro{ display:none!important; }

/* UI */
.btn{padding:12px 18px;border-radius:14px;font-size:clamp(16px,2.6vw,22px);color:#fff;text-decoration:none;cursor:pointer;
  background:linear-gradient(180deg,rgba(212,175,55,.25),rgba(212,175,55,.12));border:1px solid rgba(212,175,55,.9);
  box-shadow:0 0 0 2px rgba(212,175,55,.15) inset,0 10px 30px rgba(0,0,0,.45),0 0 22px rgba(212,175,55,.35);
  transition:transform .15s ease, box-shadow .15s ease}
.btn:hover{transform:translateY(-2px);box-shadow:0 0 0 2px rgba(212,175,55,.2) inset,0 14px 36px rgba(0,0,0,.5),0 0 28px rgba(212,175,55,.45)}

/* GATE */
#gate{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;z-index:6;padding:24px;pointer-events:auto}
#gate .panel{background:rgba(0,0,0,.55);border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:24px;max-width:820px;width:92%;text-align:center;backdrop-filter:blur(2px)}
#gate h1{font-family:Cinzel,serif;margin:0 0 8px 0;font-size:clamp(26px,5vw,40px)}
#gate p{margin:6px 0 14px 0;font-size:clamp(16px,2.5vw,20px);color:var(--mut)}

/* Intro ciné (démarre 2s après via .intro-text-start) */
.overlay{position:fixed;inset:0;display:none;align-items:center;justify-content:center;padding:20px;z-index:5}
.slide{position:relative;max-width:980px;width:100%;min-height:60vh;display:flex;align-items:center;justify-content:center}
.slide p {
  position:absolute;
  width:min(92%,900px);
  margin:0;
  text-align:center;
  font-size:clamp(22px,4vw,34px);
  line-height:1.6;
  color:#fff; /* blanc lumineux */
  text-shadow:
    0 0 4px rgba(212,175,55,0.9),   /* halo doré serré */
    0 0 8px rgba(212,175,55,0.6),   /* halo doré plus large */
    0 0 12px rgba(0,0,0,0.9);       /* contour sombre pour le contraste */
  opacity:0;
  transform:translateY(8px);
}
@keyframes onebyone{0%{opacity:0;transform:translateY(8px)}10%{opacity:1;transform:none}90%{opacity:1}100%{opacity:0;transform:translateY(-6px)}}
.intro-text-start .slide p{animation:onebyone var(--per) ease-in-out both;animation-delay:calc(var(--i)*var(--per));}
.intro-text-start .overlay{display:flex}

/* CTA après intro */
#ctaOverlay{position:fixed;inset:0;display:none;align-items:center;justify-content:center;opacity:0;pointer-events:none;z-index:6}
@keyframes enableCTA{to{pointer-events:auto}}
@keyframes fadeCTA{to{opacity:1}}
.intro-text-start #ctaOverlay{display:flex;animation:enableCTA 0s linear var(--total) forwards,fadeCTA .8s ease var(--total) forwards}

/* App */
.app{display:none;max-width:1100px;margin:28px auto;padding:16px;position:relative;z-index:7}
#app:target{display:block}
.grid{display:grid;gap:16px}
@media(min-width:980px){.grid{grid-template-columns:1fr 1fr}}
.card{background:rgba(0,0,0,.55);padding:16px;border-radius:14px;border:1px solid rgba(255,255,255,.08)}
.row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.small{font-size:14px;color:var(--mut)} .pill{background:rgba(255,255,255,.08);padding:8px 12px;border-radius:999px}
.inv-row{display:flex;align-items:center;gap:10px;flex-wrap:wrap;justify-content:space-between;border-top:1px solid rgba(255,255,255,.08);padding:10px 0;margin-top:4px}
.inv-left{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.inv-actions{display:flex;gap:8px;align-items:center}
.url-raw{font-size:12px;color:#b9c3cf;word-break:break-all}
.centered{min-height:50vh;display:flex;align-items:center;justify-content:center;text-align:center}
#playerIntro{
  font-size:clamp(20px,4vw,28px);
  text-align:center;
  margin:0 auto;
  line-height:1.5;
  color:#d4af37;
  text-shadow:0 0 6px rgba(0,0,0,.8), 0 0 12px rgba(212,175,55,.5);
}

/* Modale rôle */
.modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.75);z-index:9;padding:20px}
.modal .inner{background:#0b0f18;color:#fff;padding:24px;border-radius:16px;max-width:820px;width:100%;max-height:90vh;overflow:auto;border:1px solid rgba(255,255,255,.08)}
.role-title{font-family:Cinzel,serif;font-size:34px;margin:6px 0;display:flex;align-items:center;justify-content:center;gap:12px}
.role-sub{font-size:18px;color:var(--mut)} #roleExtra{font-size:16px;line-height:1.55}
.mask-red{filter:drop-shadow(0 0 8px rgba(255,59,59,.45));color:#ff3b3b}
.mask-blue{filter:drop-shadow(0 0 8px rgba(23,183,255,.45));color:#17b7ff}
#app:target ~ #ctaOverlay{display:none} 
#app:target ~ .overlay{display:none}
#app:target ~ #gate{display:none}
#audioUnlock{display:none;position:fixed;left:50%;bottom:18px;transform:translateX(-50%);z-index:9999;background:rgba(0,0,0,.7);color:#fff;padding:10px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.15);backdrop-filter:blur(3px);font-size:14px;white-space:nowrap}
#audioUnlock button{margin-left:8px;padding:6px 10px;border-radius:10px;border:1px solid rgba(212,175,55,.9);background:linear-gradient(180deg,rgba(212,175,55,.25),rgba(212,175,55,.12));color:#fff;cursor:pointer}

/* === Planning & Règles (inline) + Role modal (light) + Secret skip === */
.secret-fixed{position:fixed;top:12px;left:12px;width:20px;height:20px;border-radius:50%;z-index:9999;cursor:pointer;opacity:.25;
  background:radial-gradient(circle at 30% 30%, rgba(212,175,55,.95) 0%, rgba(212,175,55,.45) 45%, rgba(0,0,0,0) 60%);
  box-shadow:0 0 14px rgba(212,175,55,.55), 0 0 28px rgba(212,175,55,.35);
}
.app-shown .secret-fixed{display:none}
.welcome-section{margin:14px auto;width:min(92%,960px);background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.12);border-radius:16px;padding:16px;color:#eaf0f8}
.welcome-grid{display:grid;gap:12px}
@media(min-width:760px){.welcome-grid{grid-template-columns:1fr 1fr}}
.wc-card{background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.1);border-radius:14px;padding:12px}
.wc-card h3{margin:0 0 6px;color:#ffd98a}
.wc-card ul{margin:6px 0 0 18px}
.wc-actions{text-align:center;margin-top:10px}
.wc-btn{padding:12px 16px;border:none;border-radius:12px;background:#d4af37;color:#000;font-weight:800;cursor:pointer}
/* Role modal */
.role-modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.75);z-index:12000;padding:16px}
.role-box{background:#0b0f18;border:1px solid rgba(255,255,255,.15);border-radius:16px;padding:18px;width:min(92%,720px);color:#eaf0f8}
.role-box h3{margin:0 0 8px;color:#ffd98a;font-size:clamp(22px,4.2vw,28px)}
.role-main{font-size:clamp(18px,3.5vw,24px);margin-top:6px}
.role-actions{margin-top:12px;text-align:center}
.role-btn{padding:10px 14px;border-radius:12px;border:none;background:#d4af37;color:#000;font-weight:800;cursor:pointer}
/* Role panels (blue/red) */
.role-wrap{margin-top:12px}
.role-box-blue{border-radius:14px;padding:12px;border:1px solid rgba(255,255,255,.15);background:linear-gradient(180deg,#0e2a4d,#12345a)}
.role-box-red{border-radius:14px;padding:12px;border:1px solid rgba(255,255,255,.15);background:linear-gradient(180deg,#5a0f1b,#6e1421)}
.cta-traitor{display:inline-block;padding:10px 14px;border-radius:12px;background:#ffd87a;color:#000;font-weight:900}


/* === Video backgrounds (added) === */
.bgv{ transition:opacity 3.2s ease-in-out; }
.bgv.is-active{ opacity:1 !important; }
.intro-started #bgVideoLayer{ opacity:1 !important; } /* when intro ends, reveal looping layer */


/* === Intro panel pinned to top (override) === */
#gate{ align-items:flex-start !important; padding-top:4vh !important; }
#gate .panel.panel--dark{ margin-top:0 !important; }
@media (max-width:480px){
  #gate{ padding-top:3vh !important; }
}


/* Force full black UI chrome and safe dark scheme */
html, body { background:#000 !important; color-scheme: dark; overscroll-behavior: none; }
/* Keep intro panel pinned to top (from prior step) */
#gate{ align-items:flex-start !important; padding-top:4vh !important; }
#gate .panel.panel--dark{ margin-top:0 !important; }
@media (max-width:480px){
  #gate{ padding-top:3vh !important; }
}
</style>


<!-- PATCH: lisibilité p3 (titre blanc + panneaux sombres) -->
<style id="patch-p3-style">
  /* Titre blanc + halo (sera appliqué via JS en ajoutant id="p3Title") */
  #p3Title{
    color:#fff !important;
    font-size:clamp(20px,3.2vw,28px) !important;
    font-weight:900 !important;
    line-height:1.15 !important;
    text-shadow:0 0 14px rgba(255,255,255,.35) !important;
    margin:0 0 10px !important;
  }
  /* Panneaux règles/planning : fond noir semi-transparent */
  .panel-dark{
    background:rgba(0,0,0,.60) !important;
    border:1px solid rgba(255,255,255,.12) !important;
    box-shadow:0 10px 30px rgba(0,0,0,.30) !important;
  }
</style>

<link rel="manifest" href="/manifest.webmanifest">
<meta name="theme-color" content="#000000">
<link rel="icon" href="/icons/icon-192.png">
<style>
/* CTA visibility controlled by end of intro animation */
#ctaOverlay{opacity:0;pointer-events:none;transform:translateY(6px);transition:.4s ease;}
</style>

<style id="dual-av-css">
  #bgSoundToggle, #audioUnlock { display:none !important; }
  #enterGameOverlay{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:20; }
  #enterGameOverlay.show{ display:flex; }
</style>




</head>
<body>
<div id="secretFixed" class="secret-fixed" title="Passer l\'intro"></div>
<section class="bg-gate" aria-hidden="true" style="position:fixed;inset:0;z-index:0;">
  <video id="gateVideo" muted playsinline preload="auto"
         style="position:absolute;inset:0;width:100%;height:100%;object-fit:cover;" autoplay muted playsinline webkit-playsinline preload="auto">
  <source src="videos/intro-gate.mp4" type="video/mp4">
  <source src="videos/intro–gate.mp4" type="video/mp4">
</video>
</section>
<div id="bgVideoLayer" class="bg-intro" aria-hidden="true" style="position:fixed;inset:0;z-index:0;opacity:0;transition:opacity 1200ms ease;">
  <video id="bgv1" class="bgv" muted playsinline preload="auto"
         style="position:absolute;inset:0;width:100%;height:100%;object-fit:cover;opacity:1;" muted playsinline webkit-playsinline preload="auto">
  <source src="videos/fond-boucle-v2.mp4" type="video/mp4">
  <source src="videos/fond–boucle–v2.mp4" type="video/mp4">
</video>
  <video id="bgv2" class="bgv" muted playsinline preload="auto"
         style="position:absolute;inset:0;width:100%;height:100%;object-fit:cover;opacity:0;" muted playsinline webkit-playsinline preload="auto">
  <source src="videos/fond-boucle-v2.mp4" type="video/mp4">
  <source src="videos/fond–boucle–v2.mp4" type="video/mp4">
</video>
</div>
<div class="bg-role bg-fallback" aria-hidden="true"></div>

<!-- GATE -->
<div id="gate">
  <div class="panel">
    <h1>Vous avez été conviés par bob…</h1>
    
    <!-- Inline handler pour éviter tout problème de binding -->
    <button class="btn" type="button" onclick="startIntro()">Lancez-vous</button>
  </div>
</div>

<!-- INTRO -->
<div class="overlay">
  <div class="slide">
    </div>
</div>

<!-- CTA après intro -->
<div id="ctaOverlay"><a class="btn" href="#app">ENTRER DANS LE JEU</a></div>

<!-- APP -->
<div class="app" id="app">
  <!-- Planning & Règles -->
  <section id="welcomeSection" class="welcome-section">
    <h2 style="text-align:center;color:#ffd98a;margin:0 0 6px">Le déroulé du week-end</h2>
    
    <div class="welcome-grid">
      <div class="wc-card">
        <h3>🗓️ Le planning</h3>
        <ul>
          <li><b>Vendredi soir</b> : conseil et vote d’élimination.</li>
          <li><b>Nuit ven → sam</b> : les Traîtres choisissent discrètement une victime via leur lien.</li>
          <li><b>Samedi matin</b> : annonce au groupe du résultat de la nuit.</li>
          <li><b>Samedi midi</b> : nouveau conseil et vote.</li>
          <li><b>Samedi soir</b> : conseil et vote.</li>
          <li><b>Nuit sam → dim</b> : les Traîtres éliminent à nouveau via leur lien.</li>
          <li><b>Dimanche matin</b> : annonce au groupe de la victime de la nuit.</li>
        </ul>
      </div>
      <div class="wc-card">
        <h3>🎭 Esprit & règles</h3>
        <ul>
          <li>Les Traîtres jouent <b>en secret</b> via un lien privé (personne ne sait qui ils sont).</li>
          <li>Les Loyaux observent, discutent et votent avec stratégie.</li>
          <li>Pas de prise de tête : les écrans clés s’affichent au bon moment pour le groupe.</li>
          <li>On garde la <b>bonne entente</b> : fun & fair-play.</li>
        </ul>
      </div>
    </div>
    <!-- Role panels appear here after click -->
    <div id="roleInline" class="role-wrap" style="display:none">
      <div id="roleBlue" class="role-box-blue" style="display:none">
        <h3>Ton rôle : LOYAL 🛡️</h3>
        
      </div>
      <div id="roleRed" class="role-box-red" style="display:none">
        <h3>Ton rôle : TRAÎTRE 🕵️‍♂️</h3>
        
        <div style="text-align:center;margin-top:8px">
          <a id="voteCta" class="cta-traitor" href="#" target="_blank" rel="noopener">Voter la nuit pour éliminer un Loyal</a>
        </div>
      </div>
    </div>
  </section>

  <div class="grid">
    <!-- Organisateur -->
    <div class="card" id="orgCard">
      <h3>Créer une partie (organisateur)</h3>
      <div class="small">Noms : un par ligne ou séparés par virgule/;</div>
      <textarea id="names" rows="6" style="width:100%;margin-top:8px" placeholder="Franck
Aurélie
Nathan
Bilou
Arnaud"></textarea>
      <div class="row" style="margin-top:8px">
        <label><input type="radio" name="mode" value="pct" checked> Traîtres (%)</label>
        <input id="pct" type="number" min="10" max="60" value="25" style="width:90px;margin-left:6px">
        <label style="margin-left:8px"><input type="radio" name="mode" value="nb"> Traîtres (nb)</label>
        <input id="nb" type="number" min="1" value="2" style="width:90px;margin-left:6px">
      </div>
      <div style="margin-top:12px">
        <button id="genBtn" class="btn" type="button">Générer invitations</button>
      </div>
      <div id="invites" style="margin-top:12px"></div>
    </div>

    <!-- Joueur -->
    <div class="card" id="playerCard">
      <h3 id="playerName">Espace joueur</h3>
      <div id="playerIntro" class="small">Ouvre le lien reçu de l’organisateur pour voir ton rôle.</div>
      <div id="playerCenter" class="centered" style="display:none;margin-top:12px">
        <button id="revealBtn" class="btn" type="button">🎭 Découvre ton rôle</button>
      </div>
      <div id="roleBox" style="margin-top:12px"></div>
    </div>
  </div>
</div>

<!-- Modale rôle -->
<div id="roleModal" class="modal" aria-hidden="true">
  <div class="inner" id="roleInner">
    <div class="role-title" id="roleTitle">Votre rôle</div>
    <div class="role-sub" id="roleSub"></div>
    <div id="roleExtra" style="margin-top:12px"></div>
    <div style="text-align:center;margin-top:16px">
      <button id="closeRoleBtn" class="btn" style="font-size:18px">Fermer</button>
    </div>
  </div>
</div>

<audio id="introMusic" preload="auto" playsinline>
  <source src="musique.mp3" type="audio/mpeg">
</audio>
<div id="audioUnlock">🔊 Le son est bloqué. <button id="unlockBtn">Activer le son</button></div>




<script id="click-sync-controller">
// Démarrage audio+vidéo garanti sur le même clic "Lancez-vous"
(function(){
  const intro    = document.getElementById('gateVideo');                   // <video> intro-gate.mp4
  const bgv      = document.getElementById('bgv1') || document.getElementById('bgv2'); // <video> fond-boucle-v2.mp4
  const bga      = document.getElementById('bgAudio');                     // <audio> fond-boucle-v2.mp3
  const ctaBlock = document.getElementById('ctaOverlay');
  const startBtn = (ctaBlock && ctaBlock.querySelector('.btn')) || document.querySelector('#gate .btn'); // "Lancez-vous"
  const enterUI  = document.getElementById('enterGameOverlay');
  const enterBtn = document.getElementById('enterGameBtn');
  const SHOW_AT  = 88; // 1:28
  if (!startBtn || !bgv) return;

  // Sécuriser les attributs des vidéos
  try{
    bgv.removeAttribute('autoplay'); bgv.removeAttribute('loop');
    bgv.setAttribute('playsinline',''); bgv.setAttribute('webkit-playsinline','');
    bgv.preload = 'auto';
  }catch(e){}

  // Éliminer tout ancien écouteur sur le bouton (évitons que l'intro se relance)
  const freshBtn = startBtn.cloneNode(true);
  startBtn.parentNode.replaceChild(freshBtn, startBtn);

  freshBtn.addEventListener('click', function(ev){
    ev.preventDefault();

    // 1) Stop net de l'intro (et empêcher tout redémarrage)
    try{
      if (intro){ intro.pause(); intro.currentTime = 0; intro.style.display = 'none'; }
      if (ctaBlock){ ctaBlock.style.opacity = 0; ctaBlock.style.pointerEvents = 'none'; }
      // Essayer de neutraliser un éventuel startIntro global
      if (window.startIntro) { window.startIntro = function(){}; }
    }catch(e){}

    // 2) Démarrer la vidéo 2 + le son dans *le même handler*
    try{
      bgv.currentTime = 0;
      if (bga){
        // audio séparé = vidéo muette + audio on
        bgv.muted = true;
        bga.muted = false; bga.volume = 0.5; bga.currentTime = 0;
        bga.play().catch(()=>{});
      } else {
        // son depuis la vidéo
        bgv.muted = false; bgv.volume = 0.5;
      }
      bgv.play().catch(()=>{});
    }catch(e){}

    // 3) Afficher "Entrer dans le jeu" uniquement à 88s de lecture réelle
    let shown = false;
    const onTime = () => {
      if (!shown && bgv.currentTime >= SHOW_AT){
        shown = true;
        if (enterUI) enterUI.classList.add('show');
        bgv.removeEventListener('timeupdate', onTime);
      }
    };
    bgv.addEventListener('timeupdate', onTime, { passive:true });

    // 4) Fin propre : couper audio séparé si la vidéo s'arrête
    bgv.addEventListener('ended', () => { try{ if (bga) bga.pause(); }catch(e){} }, { once:true });
  }, { once:true });

  // "Entrer dans le jeu" : couper puis naviguer
  if (enterBtn){
    enterBtn.addEventListener('click', function(e){
      e.preventDefault();
      try{ if (bga) bga.pause(); if (bgv) bgv.pause(); }catch(e){}
      const qs = window.location.search || '';
      window.location.href = window.location.pathname + qs + '#app';
    });
  }
})();
</script>

</body>
</html>
