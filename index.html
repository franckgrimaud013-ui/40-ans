<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Les Traîtres — intro auto</title>
<style>
  html,body{margin:0;height:100%;background:#000;color:#fff;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial}
  /* Layers */
  #bgVideoLayer{position:fixed;inset:0;z-index:0;pointer-events:none;display:none}
  .bgv{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;filter:brightness(.9);opacity:0;transition:opacity 3.2s ease-in-out}
  .bgv.is-active{opacity:1}
  #gateScreen{position:fixed;inset:0;z-index:1}
  #gateVideo{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;filter:brightness(.96)}
  #blackVeil{position:fixed;inset:0;background:#000;opacity:0;pointer-events:none;z-index:10;transition:opacity 1000ms ease}
  #roleBg{position:fixed;inset:0;background:url('rolebg.jpg') center/cover no-repeat;opacity:0;transition:opacity 1.5s ease-in-out;z-index:1;display:none}
  /* Paragraphs overlay */
  .overlay{position:relative;z-index:3}
  .slide{position:fixed;left:50%;top:14vh;transform:translateX(-50%);width:min(92vw,1100px);text-align:left}
  .slide p{font-size:clamp(18px,2.4vw,28px);line-height:1.35;margin:.9em 0;text-shadow:0 2px 10px rgba(0,0,0,.55)}
  .slide p.hidden{opacity:0;transform:translateY(.4em);transition:opacity .6s ease, transform .6s ease}
  .slide p.show{opacity:1;transform:none}
  /* CTA at end of paragraphs */
  #ctaOverlay{position:fixed;left:0;right:0;bottom:6vh;display:none;justify-content:center;z-index:5}
  .btn{appearance:none;border:1px solid rgba(255,215,0,.7);background:radial-gradient(120% 120% at 50% -10%, rgba(255,215,0,.18), rgba(255,215,0,.06));color:#fff;padding:12px 22px;border-radius:999px;letter-spacing:.04em;text-transform:uppercase;font-weight:700;box-shadow:0 0 22px rgba(255,215,0,.22);cursor:pointer;transition:transform .15s ease, box-shadow .2s ease}
  .btn:hover{transform:translateY(-1px);box-shadow:0 0 28px rgba(255,215,0,.35)}
  /* Rules screen (final) */
  #rulesScreen{position:fixed;inset:0;display:none;z-index:4;pointer-events:none}
  .rules-wrap{max-width:1100px;margin:0 auto;text-align:center;color:#fff;text-shadow:0 0 4px rgba(255,255,255,.35),0 0 12px rgba(255,255,255,.18),0 2px 10px rgba(0,0,0,.55);pointer-events:auto}
  .rules-wrap h2{margin:0 0 8px;font-size:clamp(24px,4.2vw,38px);font-weight:800;letter-spacing:.02em}
  .rules-wrap p{margin:8px 0;font-size:clamp(16px,2.2vw,22px);line-height:1.35}
</style>
</head>
<body>

<!-- 0. Black veil for transitions -->
<div id="blackVeil"></div>

<!-- 1. Intro video (autoplay, muted, playsinline) -->
<section id="gateScreen" aria-label="Intro vidéo">
  <video id="gateVideo" autoplay muted playsinline preload="auto">
    <source src="videos/intro-gate.mp4" type="video/mp4">
  </video>
</section>

<!-- 2. Background looping video layer (starts after intro) -->
<div id="bgVideoLayer" aria-hidden="true">
  <video id="bgv1" class="bgv" muted playsinline preload="auto">
    <source src="videos/fond-boucle.mp4" type="video/mp4">
  </video>
  <video id="bgv2" class="bgv" muted playsinline preload="auto">
    <source src="videos/fond-boucle.mp4" type="video/mp4">
  </video>
</div>

<!-- 3. Paragraphs overlay (example content; replace with yours) -->
<div class="overlay">
  <div class="slide" id="slide">
    <p class="hidden">Vous avez été conviés pour un week‑end entre amis…</p>
    <p class="hidden">Un week‑end d’amitié, de rires, de bons repas…</p>
    <p class="hidden">Mais derrière cette fête se cache un jeu… discret, mais omniprésent.</p>
    <p class="hidden">On m’a beaucoup parlé de vous…</p>
    <p class="hidden" id="intro-last">Que la partie commence…</p>
  </div>
</div>

<!-- 4. CTA that appears at the end of the paragraphs -->
<div id="ctaOverlay"><button id="enterBtn" class="btn">Entrer dans le jeu</button></div>

<!-- 5. Third background image for final screen -->
<div id="roleBg" aria-hidden="true"></div>

<!-- 6. Final rules screen -->
<section id="rulesScreen" aria-label="Règles">
  <div style="position:absolute;inset:0;display:flex;align-items:center;justify-content:center;padding:10vh 4vw;">
    <div class="rules-wrap">
      <h2>Règles du jeu</h2>
      <p>Un jeu entre amis, pour pimenter le week‑end. À chaque étape, le groupe délibère… et la nuit, les traîtres agissent discrètement.</p>
      <p><strong>Franck ne connaît pas votre rôle.</strong></p>
      <p style="margin-bottom:18px;">Gardez le fair‑play, amusez‑vous, et méfiez‑vous des apparences…</p>
      <button id="discoverBtn" class="btn">Découvre ton rôle</button>
    </div>
  </div>
</section>

<!-- 7. Music (starts on user click) -->
<audio id="introMusic" preload="auto">
  <source src="musique.mp3" type="audio/mpeg">
</audio>

<script>
// Force-play intro video on iOS (muted) + fallback
(function(){
  const v = document.getElementById('gateVideo');
  if (!v) return;
  v.muted = true; v.playsInline = true;
  const tryPlay = ()=>{ v.play().catch(()=>{}); };
  v.addEventListener('loadeddata', tryPlay, {once:true});
  setTimeout(tryPlay, 300); // extra nudge
})();

// Crossfade loop engine for background videos
(function(){
  const layer = document.getElementById('bgVideoLayer');
  const v1 = document.getElementById('bgv1');
  const v2 = document.getElementById('bgv2');
  const CROSSFADE = 2.8;
  let active = v1, next = v2, armed = false;

  function armLoop(video){
    if (armed) return;
    armed = true;
    const dur = video.duration || 0;
    if (!dur || !isFinite(dur)) {
      video.addEventListener('loadedmetadata', ()=>{ armed=false; armLoop(video); }, {once:true});
      return;
    }
    const tick = () => {
      if (video.paused || video.ended) return;
      const t = video.currentTime;
      if (dur - t <= CROSSFADE + 0.6) {
        next.currentTime = 0;
        next.play().catch(()=>{});
        active.classList.remove('is-active');
        next.classList.add('is-active');
        const old = active; active = next; next = old;
        armed = false;
        armLoop(active);
      } else {
        requestAnimationFrame(tick);
      }
    };
    requestAnimationFrame(tick);
  }

  window.__bgVideoStart = function start(){
    try{
      layer.style.display='block';
      v1.currentTime = 0; v2.currentTime = 0;
      v1.muted = true; v2.muted = true;
      v1.playsInline = true; v2.playsInline = true;
      v1.play().catch(()=>{});
      v2.load();
    }catch(e){}
    v1.classList.add('is-active');
    armLoop(v1);
  }
})();

// Flow controller
(function(){
  const veil = document.getElementById('blackVeil');
  const gate = document.getElementById('gateScreen');
  const gateVideo = document.getElementById('gateVideo');
  const music = document.getElementById('introMusic');
  const cta = document.getElementById('enterBtn');
  const ctaWrap = document.getElementById('ctaOverlay');
  const role = document.getElementById('roleBg');
  const rules = document.getElementById('rulesScreen');

  // Show paragraphs one by one
  (function revealParagraphs(){
    const ps = Array.from(document.querySelectorAll('#slide p'));
    let i = 0;
    function showNext(){
      if (i < ps.length){
        ps[i].classList.remove('hidden');
        ps[i].classList.add('show');
        i++; setTimeout(showNext, 1800);
      } else {
        // reveal CTA
        ctaWrap.style.display='flex';
      }
    }
    setTimeout(showNext, 800);
  })();

  // When intro ends, switch to bg loop (no sound yet)
  function afterIntro(){
    veil.style.opacity = '1';
    setTimeout(()=>{
      try{ gateVideo.pause(); }catch(e){}
      if (window.__bgVideoStart) window.__bgVideoStart();
      gate.style.display='none';
      veil.style.opacity = '0';
    }, 1000);
  }
  gateVideo.addEventListener('ended', afterIntro);
  // Safety: if intro fails or is too short, go on anyway
  setTimeout(()=>{
    if (getComputedStyle(document.getElementById('bgVideoLayer')).display==='none') afterIntro();
  }, 15000);

  // CTA click: show role BG + rules + start music
  if (cta){
    cta.addEventListener('click', function(e){
      e.preventDefault();
      // Fade in role background
      role.style.display='block';
      requestAnimationFrame(()=>{ requestAnimationFrame(()=>{ role.style.opacity='1'; }); });
      // Hide paragraphs & CTA
      document.querySelector('.overlay').style.display='none';
      ctaWrap.style.display='none';
      // Show rules
      rules.style.display='block';
      // Start music
      try{ music.volume=0.35; music.currentTime=0; music.play().catch(()=>{}); }catch(err){}
    });
  }
})();
</script>
</body>
</html>
