<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>40 ans Franck</title>

  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#000000" />
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000000" />

  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="Les 40 ans de Franck" />
  <link rel="apple-touch-icon" sizes="180x180" href="icon-512.png" />

  <link rel="icon" sizes="512x512" href="icon-512.png" />
  <link rel="manifest" href="manifest.json" />

  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700;900&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet" />

  <script>
    (function() {
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('./sw.js', { scope: './' }).catch(console.error);
      }
    })();
  </script>

  <style>
    :root{--fg:#fff;--mut:#cfd5dc;--per:6s;--count:15;--total:calc((var(--per) + 5s)*var(--count) + 0.5s)}
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:'Playfair Display',serif;color:var(--fg);background:#000}

    .bg-fallback{background:radial-gradient(ellipse at center,#0a0d12 0%,#05070b 60%,#000 100%)}

    .bg-gate,.bg-intro{
      position:fixed; inset:0;
      background-size:cover; background-position:center;
      z-index:0;opacity:1; transition:opacity 1200ms ease; will-change:opacity;
      background:none;
    }
    .bg-gate{ background-image:url('photo1.jpg'); }
    .bg-intro{ opacity:0; }
    .intro-started .bg-gate{ opacity:0; }
    .intro-started .bg-intro{ opacity:1; }
    .bg-role{
      position:fixed; inset:0; background:center/cover no-repeat; z-index:0; display:none;
    }
    .player-focus .bg-role{ display:block; }
    .player-focus .bg-gate, .player-focus .bg-intro{ display:none !important; }

    .btn{padding:12px 18px;border-radius:14px;font-size:clamp(16px,2.6vw,22px);color:#fff;text-decoration:none;cursor:pointer;
      background:linear-gradient(180deg,rgba(212,175,55,.25),rgba(212,175,55,.12));border:1px solid rgba(212,175,55,.9);
      box-shadow:0 0 0 2px rgba(212,175,55,.15) inset,0 10px 30px rgba(0,0,0,.45),0 0 22px rgba(212,175,55,.35);
      transition:transform .15s ease, box-shadow .15s ease}
    .btn:hover{transform:translateY(-2px);box-shadow:0 0 0 2px rgba(212,175,55,.2) inset,0 14px 36px rgba(0,0,0,.5),0 0 28px rgba(212,175,55,.45)}

    #gate{position:fixed;inset:0;display:flex;align-items:flex-end;justify-content:center;padding-bottom:30vh;z-index:6}
    #gate .panel{text-align:center}
    #gate h1{font-family:Cinzel,serif;margin:0 0 8px 0;font-size:clamp(26px,5vw,40px)}
    #gate p{margin:6px 0 14px 0;font-size:clamp(16px,2.5vw,20px);color:var(--mut)}

    .overlay{position:fixed;inset:0;display:none;align-items:center;justify-content:center;padding:20px;z-index:5}
    .slide{position:relative;max-width:980px;width:100%;min-height:60vh;display:flex;align-items:center;justify-content:center}
    .slide p{position:absolute;width:min(92%,900px);margin:0;text-align:center;font-size:clamp(22px,4vw,34px);line-height:1.6;color:#fff;
      text-shadow:0 0 4px rgba(212,175,55,.9),0 0 8px rgba(212,175,55,.6),0 0 12px rgba(0,0,0,.9);opacity:0;transform:translateY(8px)}
    @keyframes onebyone{0%{opacity:0;transform:translateY(8px)}10%{opacity:1;transform:none}90%{opacity:1}100%{opacity:0;transform:translateY(-6px)}}
    .intro-text-start .slide p{animation:onebyone var(--per) ease-in-out both;animation-delay:calc(var(--i)*var(--per));}
    .intro-text-start .overlay{display:flex}

    #ctaOverlay{position:fixed;inset:0;display:none;align-items:center;justify-content:center;opacity:0;pointer-events:none;z-index:6;transition:.4s ease;transform:translateY(6px)}
    .intro-text-start #ctaOverlay{display:flex;animation:enableCTA 0s linear var(--total) forwards,fadeCTA .8s ease var(--total) forwards}
    @keyframes enableCTA{to{pointer-events:auto}}
    @keyframes fadeCTA{to{opacity:1}}

    .app{display:none;max-width:1100px;margin:3px auto;padding:5px;position:relative;z-index:7}
    #app:target{display:block}
    .grid{display:grid;gap:16px}
    @media(min-width:980px){.grid{grid-template-columns:1fr 1fr}}
    .card{background:rgba(0,0,0,.55);padding:16px;border-radius:14px;border:1px solid rgba(255,255,255,.08)}
    .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .small{font-size:14px;color:var(--mut)} .pill{background:rgba(255,255,255,.08);padding:8px 12px;border-radius:999px}
    .inv-row{display:flex;align-items:center;gap:10px;flex-wrap:wrap;justify-content:space-between;border-top:1px solid rgba(255,255,255,.08);padding:10px 0;margin-top:4px}
    .inv-left{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .inv-actions{display:flex;gap:8px;align-items:center}
    .url-raw{font-size:12px;color:#b9c3cf;word-break:break-all}
    .centered{min-height:50vh;display:flex;align-items:center;justify-content:center;text-align:center}
    #playerIntro{font-size:clamp(20px,4vw,28px);text-align:center;margin:0 auto;line-height:1.5;color:#d4af37;text-shadow:0 0 6px rgba(0,0,0,.8),0 0 12px rgba(212,175,55,.5)}

    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.75);z-index:9;padding:20px}
    .modal .inner{background:#0b0f18;color:#fff;padding:24px;border-radius:16px;max-width:820px;width:100%;max-height:90vh;overflow:auto;border:1px solid rgba(255,255,255,.08)}
    .role-title{font-family:Cinzel,serif;font-size:34px;margin:6px 0;display:flex;align-items:center;justify-content:center;gap:12px}
    .role-sub{font-size:18px;color:var(--mut)} #roleExtra{font-size:16px;line-height:1.55}
    .mask-red{filter:drop-shadow(0 0 8px rgba(255,59,59,.45));color:#ff3b3b}
    .mask-blue{filter:drop-shadow(0 0 8px rgba(23,183,255,.45));color:#17b7ff}

    .secret-fixed{position:fixed;top:12px;left:12px;width:20px;height:20px;border-radius:50%;z-index:9999;cursor:pointer;opacity:.25;
      background:radial-gradient(circle at 30% 30%, rgba(212,175,55,.95) 0%, rgba(212,175,55,.45) 45%, rgba(0,0,0,0) 60%);
      box-shadow:0 0 14px rgba(212,175,55,.55), 0 0 28px rgba(212,175,55,.35);
    }
    .app-shown .secret-fixed{display:none}

    .welcome-section{margin:14px auto;width:min(92%,960px);background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.12);border-radius:16px;padding:16px;color:#eaf0f8}
    .layout-simple{background:#000}
    .top-video{max-width:1100px;margin:0 auto;padding-top:0}
    .video-frame{position:relative;width:100%;aspect-ratio:16/9;background:#000}
    video.p3-topvid{position:absolute;inset:0;width:100%;height:100%;object-fit:contain;display:block;background:#000}

    .bottom-steps{max-width:980px;margin:14px auto 0}
    #p3-steps .step{display:none;opacity:0;transform:translateY(8px);transition:opacity .35s ease, transform .35s ease}
    #p3-steps .step.active{display:block;opacity:1;transform:none}

    .p3-photo-title{font-family:Cinzel,serif;font-weight:900;text-align:center;color:#d4af37;font-size:clamp(26px,5vw,42px);margin:6px 0 18px;text-underline-offset:8px;text-decoration-thickness:2px}
    .plan-list{list-style:none;padding:0;margin:0}
    .plan-item{display:flex;align-items:baseline;gap:.2rem;margin:6px 0;font-size:clamp(18px,3.2vw,26px);line-height:1.6}
    .plan-item .left{color:#d4af37;font-style:italic;white-space:nowrap}
    .plan-item .dots{flex:1 1 auto;border-bottom:2px dotted rgba(212,175,55,.85);transform:translateY(-2px);margin:0 .5rem}
    .plan-item .right{color:#fff}

    .rules-wrap{text-align:center}
    .rules-wrap p{margin:12px auto;width:min(92%,920px);font-size:clamp(20px,4.4vw,36px);line-height:1.6;color:#fff}
    .rules-wrap p.final{color:#d4af37;font-style:italic;font-size:clamp(20px,4.2vw,34px);margin-top:18px}

    .p3-actions{display:flex;justify-content:center;margin:14px 0 0}

    #audioUnlock{display:none;position:fixed;left:50%;bottom:18px;transform:translateX(-50%);z-index:9999;background:rgba(0,0,0,.7);color:#fff;padding:10px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.15);backdrop-filter:blur(3px);font-size:14px;white-space:nowrap}
    #audioUnlock button{margin-left:8px;padding:6px 10px;border-radius:10px;border:1px solid rgba(212,175,55,.9);background:linear-gradient(180deg,rgba(212,175,55,.25),rgba(212,175,55,.12));color:#fff;cursor:pointer}

    #startBtn{opacity:0;transform:translateY(30px) scale(0.95);animation:revealButton 1.6s ease-out 1s forwards;position:relative;overflow:hidden}
    @keyframes revealButton{0%{opacity:0;transform:translateY(30px) scale(0.95);filter:brightness(0.85)}60%{opacity:1;transform:translateY(-5px) scale(1.05);filter:brightness(1.15)}100%{opacity:1;transform:translateY(0) scale(1);filter:brightness(1)}}
    #startBtn::after{content:"";position:absolute;top:0;left:-75%;width:50%;height:100%;background:linear-gradient(120deg, rgba(255,255,255,0.0) 0%, rgba(255,255,255,0.4) 50%, rgba(255,255,255,0.0) 100%);transform:skewX(-20deg);animation:shineEffect 2.5s ease-in-out 2s forwards}
    @keyframes shineEffect{0%{left:-75%}50%{left:120%}100%{left:120%}}

    .personal-step{display:none}
    .pm-card{margin:16px auto 8px;max-width:780px;padding:22px 18px;border:1px solid rgba(255,255,255,.12);border-radius:12px;background:rgba(255,255,255,.04);box-shadow:inset 0 0 40px rgba(255,255,255,.03)}
    .pm-text{font-size:.9rem;line-height:1.7;color:#e9edf4;text-align:center;white-space:pre-line}

    html, body { background:#000 !important; color-scheme: dark; overscroll-behavior: none; }

    /* iOS guide overlay */
    #iosGuide{position:fixed;inset:0;z-index:99998;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.85);backdrop-filter:blur(4px)}
    #iosGuide.show{display:flex}
    #iosGuide .box{width:min(92vw,600px);max-height:92vh;background:#0b0b0b;border-radius:14px;overflow:hidden;box-shadow:0 20px 60px rgba(0,0,0,.6);display:grid;grid-template-rows:auto 1fr auto}
    #iosGuide header{padding:14px 16px;color:#ffd98a;font-family:Cinzel,serif;font-size:18px;text-align:center;border-bottom:1px solid rgba(255,255,255,.09)}
    #iosGuide .content{padding:14px 16px;color:#e6e6e6;line-height:1.45;text-align:center}
    #iosGuide .hint{color:#bfc6cf;font-size:13px;opacity:.85;margin-top:8px;text-align:center}
    #iosGuide footer{display:flex;gap:10px;justify-content:center;padding:12px;border-top:1px solid rgba(255,255,255,.09)}
    #iosGuide .btn{appearance:none;border:0;border-radius:10px;padding:10px 14px;cursor:pointer}
    #iosGuide .btn.primary{background:#ffd98a;color:#1a1a1a;font-weight:700}
    #iosGuide .btn.ghost{background:transparent;color:#fff;border:1px solid rgba(255,255,255,.25)}
  </style>
</head>
<body>
  <div id="secretFixed" class="secret-fixed" title="Passer l'intro"></div>

  <section class="bg-gate" aria-hidden="true" style="position:fixed;inset:0;z-index:0;">
    <video id="gateVideo" autoplay muted playsinline preload="auto" style="position:absolute;inset:0;width:100%;height:100%;object-fit:cover;" webkit-playsinline>
      <source src="videos/intro-gate.mp4" type="video/mp4" />
    </video>
  </section>

  <div id="bgVideoLayer" class="bg-intro" aria-hidden="true" style="position:fixed;inset:0;z-index:0;opacity:0;transition:opacity 1200ms ease;">
    <video id="bgv1" class="bgv" muted playsinline preload="auto" style="position:absolute;inset:0;width:100%;height:100%;object-fit:cover;opacity:1;" webkit-playsinline>
      <source src="videos/fond-boucle-v2.mp4" type="video/mp4" />
    </video>
    <video id="bgv2" class="bgv" muted playsinline preload="auto" style="position:absolute;inset:0;width:100%;height:100%;object-fit:cover;opacity:0;" webkit-playsinline>
      <source src="videos/fond-boucle-v2.mp4" type="video/mp4" />
    </video>
  </div>

  <div class="bg-role bg-fallback" aria-hidden="true"></div>

  <div id="gate">
    <div class="panel">
      <button id="startBtn" class="btn" type="button" onclick="startIntro()" style="display:none">Lancez-vous</button>
    </div>
  </div>

  <div class="overlay"><div class="slide"></div></div>

  <div id="ctaOverlay"><a class="btn" href="#app">Entrer dans le jeu</a></div>

  <div id="app" class="app">
    <section id="welcomeSection" class="welcome-section layout-simple" style="background:#000; padding:0 16px 24px;">
      <div class="top-video">
        <div class="video-frame">
          <video class="p3-topvid" autoplay loop muted playsinline preload="auto">
            <source src="videos/role-bg.mp4?v=24" type="video/mp4" />
          </video>
        </div>
      </div>

      <div class="bottom-steps">
        <div id="p3-steps">
          <section id="p3-s1" class="step active">
            <h3 class="p3-photo-title">Planning du jeu</h3>
            <ul class="plan-list">
              <li class="plan-item"><span class="left">Vendredi soir :</span><span class="dots"></span><span class="right">Premier conseil et vote dâ€™Ã©limination.</span></li>
              <li class="plan-item"><span class="left">Nuit vendredi â†’ samedi :</span><span class="dots"></span><span class="right">Les TraÃ®tres bannissent un loyal via leur lien.</span></li>
              <li class="plan-item"><span class="left">Samedi matin :</span><span class="dots"></span><span class="right">Annonce au groupe du rÃ©sultat de la nuit.</span></li>
              <li class="plan-item"><span class="left">Samedi midi :</span><span class="dots"></span><span class="right">Second conseil et vote dâ€™Ã©limination.</span></li>
              <li class="plan-item"><span class="left">Samedi soir :</span><span class="dots"></span><span class="right">TroisiÃ¨me conseil et vote dâ€™Ã©limination.</span></li>
              <li class="plan-item"><span class="left">Nuit samedi â†’ dimanche :</span><span class="dots"></span><span class="right">Les TraÃ®tres Ã©liminent Ã  nouveau via leur lien.</span></li>
              <li class="plan-item"><span class="left">Dimanche matin :</span><span class="dots"></span><span class="right">Annonce au groupe de la victime de la nuit.</span></li>
              <li class="plan-item"><span class="left">Dimanche midi :</span><span class="dots"></span><span class="right">Dernier conseil et vote dâ€™Ã©limination.</span></li>
            </ul>
            <div class="p3-actions"><button id="p3-n1" class="btn" type="button">Suivant</button></div>
          </section>

          <section id="p3-s2" class="step">
            <h3 class="p3-photo-title">Esprit et rÃ¨gles</h3>
            <div class="rules-wrap">
              <p>Les TraÃ®tres jouent en secret via un lien privÃ©.</p>
              <p>Les Loyaux observent, discutent et votent avec stratÃ©gie.</p>
              <p>Pas de prise de tÃªte: les Ã©crans clÃ©s sâ€™affichent au bon moment.</p>
              <p>On garde la bonne entente: fun et fair-play.</p>
              <p class="final">Les traÃ®tres devront tous Ãªtre dÃ©masquÃ©s le dimanche midi; si ce nâ€™est pas le cas, les loyaux auront perdu le jeu.</p>
            </div>
            <div class="p3-actions"><button id="p3-n2" class="btn" type="button">Suivant</button></div>
          </section>

          <section id="p3-s3" class="step">
            <h3 id="p3-playerLine" class="p3-title">Es-tu prÃªt? Quand tu es seul, dÃ©couvre ton rÃ´le.</h3>
            <div class="p3-actions"><a id="p3-revealLink" class="btn" href="#">ðŸŽ­ DÃ©couvre ton rÃ´le</a></div>
            <p id="finalQuote">
              <span class="line">DerriÃ¨re ce scÃ©nario, il y a des semaines de travail.</span>
              <span class="line">Franck a Ã©crit, montÃ© et faÃ§onnÃ© chaque image, chaque son, chaque ligne pour vous faire vivre un week-end unique. Mais rassurez-vous, il ne peut pas et surtout ne veut pas connaÃ®tre vos rÃ´les pour pouvoir participer Ã  ce jeu avec vous.</span>
              <span class="line">Ã€ prÃ©sent, Ã  vous de jouerâ€¦ et dâ€™aller jusquâ€™au bout.</span>
              <span class="line quote">Â« Câ€™est le temps que tu as perdu pour tes amis, qui fait tes amis si importants. Â»</span>
              <span class="line author">â€” Antoine de Saint-ExupÃ©ry</span>
            </p>
            <style>
              .p3-title{margin:10px 0 8px;color:#ffd98a;font-size:clamp(20px,4.6vw,28px);font-family:Cinzel,serif;text-align:center;width:100%}
              #finalQuote{ text-align:center; margin:70px auto 60px; line-height:1.8; max-width:800px }
              #finalQuote .line{ display:block; opacity:0; transform:translateY(8px); font-size:.9rem; color:#f5f5f5; animation:fadeLine 1s ease-out forwards }
              #finalQuote .line:nth-child(1){animation-delay:.3s}
              #finalQuote .line:nth-child(2){animation-delay:.9s}
              #finalQuote .line:nth-child(3){animation-delay:1.5s}
              #finalQuote .line.quote{ font-size:.9rem; margin-top:30px; color:#d4af37; font-style:italic; text-shadow: 0 0 12px rgba(212,175,55,.3); animation-delay:2.2s }
              #finalQuote .line.author{ font-size:.6rem; color:rgba(190,190,190,.65); margin-top:10px; font-style:italic; text-shadow:none; animation-delay:2.9s }
              @keyframes fadeLine{0%{opacity:0;transform:translateY(8px)}60%{opacity:1;transform:translateY(0)}100%{opacity:1;transform:translateY(0)}}
            </style>
          </section>

          <section id="page-franck" class="step personal-step">
            <h3 class="p3-photo-title">Un mot pour toi, Franck</h3>
            <div class="pm-card"><p class="pm-text">Franck, profite du jeuâ€¦ et garde un Å“il partout ðŸ˜‰</p></div>
            <div class="p3-actions"><button class="btn nextBtn" data-next="p3-s3" type="button">Suivant</button></div>
          </section>
        </div>
      </div>
    </section>
  </div>

  <div id="roleModal" class="modal" aria-hidden="true">
    <div id="roleInner" class="inner">
      <div id="roleTitle" class="role-title">Votre rÃ´le</div>
      <div id="roleSub" class="role-sub"></div>
      <div id="roleExtra" style="margin-top:12px"></div>
      <div style="text-align:center;margin-top:16px"><button id="closeRoleBtn" class="btn" style="font-size:18px">Fermer</button></div>
    </div>
  </div>

  <audio id="introMusic" playsinline preload="auto">
    <source src="audio/fond-boucle-v2.mp3" type="audio/mpeg" />
  </audio>
  <div id="audioUnlock">ðŸ”Š Le son est bloquÃ©. <button id="unlockBtn">Activer le son</button></div>

  <!-- iOS guide overlay -->
  <div id="iosGuide" role="dialog" aria-modal="true" aria-labelledby="iosGuideTitle">
    <div class="box">
      <header id="iosGuideTitle">Astuce iPhone</header>
      <div class="content">
        <p>Pour une expÃ©rience optimale, ajoute ce site Ã  lâ€™Ã©cran dâ€™accueil.</p>
        <p>Ouvre le bouton Partager puis choisis Sur lâ€™Ã©cran dâ€™accueil.</p>
        <p class="hint">AprÃ¨s installation, le site sâ€™ouvrira en plein Ã©cran comme une application.</p>
      </div>
      <footer>
        <button class="btn ghost" id="iosDismiss">Plus tard</button>
        <button class="btn primary" id="iosOk">Jâ€™ai compris</button>
      </footer>
    </div>
  </div>

  <script>
    function parseToken(){
      try{
        var p=new URLSearchParams(location.search||'');
        if(p.has('t')){ return JSON.parse(decodeURIComponent(atob(p.get('t')))); }
      }catch(e){}
      return null;
    }
    var PAYLOAD=null;

    function startIntro(){
      try{
        document.documentElement.classList.add('intro-started');
        var gate=document.getElementById('gate'); if(gate) gate.style.display='none';
        var v1=document.getElementById('bgv1');
        var v2=document.getElementById('bgv2');
        var audio=document.getElementById('introMusic');
        var auEl=document.getElementById('audioUnlock');

        if (v1){ try{ v1.muted = true; v1.currentTime = 0; }catch(e){} }
        if (v2){ try{ v2.muted = true; v2.currentTime = 0; }catch(e){} }
        if (audio){ try{ audio.loop = true; audio.volume = 0.35; audio.currentTime = 0; }catch(e){} }

        var plays = [];
        if (v1) plays.push(v1.play().catch(()=>{}));
        if (v2) plays.push(v2.play().catch(()=>{}));
        Promise.all(plays).then(function(){
          if (!audio) return;
          var p = audio.play();
          if (p && typeof p.then === 'function'){
            p.then(function(){ if(auEl) auEl.style.display='none'; })
             .catch(function(){ if(auEl) auEl.style.display='block'; });
          }
        });

        function masterTime(){ if (!v1) return null; try { return v1.currentTime; } catch(e){ return null; } }
        function resync(){
          if (!audio || audio.paused) return;
          const vt = masterTime(); if (vt == null || !isFinite(vt)) return;
          let at = 0; try { at = audio.currentTime; } catch(e){ return; }
          const d = vt - at;
          const HARD = 0.030; const SOFT = 0.008; const GAIN = 0.030; const MINR = 0.97; const MAXR = 1.03;
          window.__lastSnap = window.__lastSnap || performance.now();
          if (Math.abs(d) > HARD || (Math.abs(d) > 0.015 && performance.now() - window.__lastSnap > 7000)) {
            try { audio.currentTime = vt; } catch(e){}
            try { audio.playbackRate = 1.0; } catch(e){}
            window.__lastSnap = performance.now();
          } else if (Math.abs(d) > SOFT) {
            const r = 1 + d * GAIN; try { audio.playbackRate = Math.max(MINR, Math.min(MAXR, r)); } catch(e){}
          } else {
            try { audio.playbackRate = 1.0; } catch(e){}
          }
        }
        if (window.__syncTimer) { clearInterval(window.__syncTimer); window.__syncTimer = null; }
        window.__syncTimer = setInterval(resync, 120);

        setTimeout(function(){ document.documentElement.classList.add('intro-text-start'); }, 2000);
      }catch(e){ console.error(e); alert('Erreur de dÃ©marrage'); }
    }

    function onEnterApp(){
      try{
        if (PAYLOAD){
          document.documentElement.classList.add('player-focus');
          var cta=document.getElementById('ctaOverlay'); if(cta) cta.style.display='none';
          var pIntro=document.getElementById('playerIntro');
          if(pIntro && PAYLOAD.name){
            pIntro.innerHTML = PAYLOAD.name + ", es-tu prÃªt? Quand tu es seul, dÃ©couvre ta carte.";
          }
          var btn=document.getElementById('revealBtn');
          if(btn && !btn._bound){ btn._bound=true; btn.addEventListener('click', function(){ revealRole(PAYLOAD); }); }
        }
      }catch(e){ console.error(e); }
    }
    function onHashChange(){ if (location.hash==="#app\"){ onEnterApp(); } }
    window.addEventListener('hashchange', onHashChange);

    document.addEventListener('DOMContentLoaded', function(){
      try{
        PAYLOAD=parseToken();
        if (location.hash===\"#app\"){ onEnterApp(); }
        setTimeout(function(){ var sb=document.getElementById('startBtn'); if(sb) sb.style.display='inline-block'; }, 300);
      }catch(e){ console.error(e); }
    });

    function revealRole(payload){
      var modal=document.getElementById('roleModal'); var inner=document.getElementById('roleInner'); var title=document.getElementById('roleTitle'); var sub=document.getElementById('roleSub'); var extra=document.getElementById('roleExtra');
      modal.style.display='flex';
      if(payload && payload.role==='TRAITRE'){
        inner.style.background='linear-gradient(180deg,#4a0b0b,#220606)';
        title.innerHTML='<span class=\"mask-red\">ðŸŽ­</span> TRAÃŽTRE'; title.style.color='#fff';
        var q=payload.codeQ||\"Quelle heure est-il ?\"; var a=payload.codeA||\"11h23\";
        sub.innerHTML='Ton objectif est dâ€™Ã©liminer les Loyaux sans te faire dÃ©masquer.<br><br>' +
          'Pour reconnaÃ®tre tes alliÃ©s traÃ®tres, tu disposes dâ€™une consigne secrÃ¨te :<br>' +
          'Question: Â« '+q+' Â»<br>' +
          'RÃ©ponse: Â« '+a+' Â» (mÃªme si câ€™est faux).<br><br>' +
          'Tu peux soit poser toi-mÃªme la question pour tester quelquâ€™un, soit rÃ©pondre avec le code si on te la pose.' +
          '<br><br><span style=\"color:#ffd87a;\">Astuce:</span> si tu veux Ã©viter de revoir toutes les vidÃ©os dâ€™intro et aller directement Ã  la page des votes, un petit bouton jaune discret est visible en haut Ã  gauche de lâ€™Ã©cran.';
        extra.innerHTML='<div style=\"margin-top:6px;color:#f2b3b3\">Ne rÃ©vÃ¨le jamais ton code directement â€” utilise-le subtilement.</div>';
      } else {
        inner.style.background='linear-gradient(180deg,#0b1f4a,#061022)';
        title.innerHTML='<span class=\"mask-blue\">ðŸŽ­</span> LOYAL'; title.style.color='#fff';
        sub.innerHTML='Ton rÃ´le: observer, discuter et dÃ©masquer les traÃ®tres.';
        extra.innerHTML='';
      }
      document.getElementById('closeRoleBtn').onclick=function(){ modal.style.display='none'; };
    }
  </script>

  <!-- Android prompt and iOS guide logic -->
  <script>
    (function () {
      const isStandalone = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone === true;
      const ua = navigator.userAgent.toLowerCase();
      const isAndroid = ua.includes('android');
      const isIOS = /iphone|ipad|ipod/.test(ua);
      const isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);

      let deferredPrompt = null;
      window.addEventListener('beforeinstallprompt', (e) => { e.preventDefault(); deferredPrompt = e; });

      document.addEventListener('DOMContentLoaded', () => {
        // Android: no prompt wanted â€” do nothing on Android here.

        // iOS Safari: show add-to-home-screen guide when not installed
        if (isIOS && isSafari && !isStandalone) {
          const iosGuide = document.getElementById('iosGuide');
          if (iosGuide) {
            iosGuide.classList.add('show');
            document.getElementById('iosDismiss').addEventListener('click', () => iosGuide.classList.remove('show'));
            document.getElementById('iosOk').addEventListener('click', () => iosGuide.classList.remove('show'));
          }
        }
      });
    })();
  </script>
</body>
</html>




















