<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Les Tra√Ætres ‚Äî 40 ans</title>
  <meta name="theme-color" content="#070c16" />
  <style>
    :root{
      --bg:#070c16; --text:#eaf0f8; --mut:#cfd5dc; --gold:#d4af37;
      --blue:#0e2a4d; --blue2:#12345a; --red:#5a0f1b; --red2:#6e1421;
      --glow:0 0 18px rgba(255,216,122,.32);
    }
    *{ box-sizing:border-box }
    html,body{ height:100%; }
    body{ margin:0; background:var(--bg); color:var(--text); font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; }
    a{ color:var(--gold); text-decoration:none }
    a:hover{ text-decoration:underline }
    .wrap{ max-width:1100px; margin:0 auto; padding:18px }

    /* Bouton/point secret */
    .secret-fixed{
      position:fixed; top:12px; left:12px; width:18px; height:18px; border-radius:50%;
      z-index:9999; cursor:pointer; opacity:.5;
      background:radial-gradient(circle at 30% 30%, rgba(212,175,55,.95) 0%, rgba(212,175,55,.45) 45%, rgba(0,0,0,0) 60%);
      box-shadow:0 0 14px rgba(212,175,55,.55), 0 0 28px rgba(212,175,55,.35);
      transition:opacity .3s ease;
    }
    .secret-fixed:hover{ opacity:.35; }
    .hide-secret .secret-fixed{ display:none; } /* cach√© sur la page 3 */

    /* Pages & transitions */
    .page{ min-height:100vh; display:none; opacity:0; transition:opacity .5s ease; position:relative; }
    .page.show{ display:block; opacity:1; }

    /* Pages 1 & 2 avec image + overlay */
    .bg-cover{ position:absolute; inset:0; background-position:center; background-size:cover; filter:contrast(1.04) saturate(1.04); }
    .overlay{ position:absolute; inset:0;
      background: radial-gradient(120% 120% at 50% 30%, rgba(0,0,0,.15) 0%, rgba(0,0,0,.55) 55%, rgba(0,0,0,.85) 100%);
    }
    .center-hero{ position:relative; min-height:100vh; display:flex; align-items:center; justify-content:center; text-align:center; padding:32px 16px; }
    h1.hero{ color:#ffd87a; font-weight:900; letter-spacing:.3px; text-shadow:var(--glow); margin:0 0 10px; }
    .lead{ font-size:18px; color:#eaf0f8; text-shadow:0 0 12px rgba(0,0,0,.35); }

    /* Boutons */
    .btn{ display:inline-block; padding:14px 18px; border-radius:14px; background:var(--gold); color:#000; border:none; cursor:pointer; font-weight:800; box-shadow:0 6px 28px rgba(212,175,55,.18); }
    .btn:active{ transform:translateY(1px) }
    .mut{ color:var(--mut) }
    .sp{ height:16px }

    /* Page 3 : contenu */
    .panel{ background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12); border-radius:16px; padding:18px; }
    .grid{ display:grid; gap:14px }
    @media(min-width:820px){ .grid{ grid-template-columns:1fr 1fr } }
    .card{ background:rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.1); border-radius:14px; padding:14px }
    .card h3{ margin:0 0 8px; color:#ffd98a }
    .card ul{ margin:6px 0 0 18px }

    /* R√¥le */
    .role-wrap{ margin-top:16px; display:none }
    .role-box{ border-radius:16px; padding:16px; border:1px solid rgba(255,255,255,.15) }
    .role-blue{ background:linear-gradient(180deg, var(--blue), var(--blue2)) }
    .role-red{  background:linear-gradient(180deg, var(--red), var(--red2)) }
    .role-title{ margin:0 0 8px; font-size:22px; font-weight:900 }
    .role-sub{ margin:0; color:#f3f6ff }
    .role-actions{ margin-top:12px; text-align:center }
    .cta-traitor{ display:inline-block; padding:12px 16px; border-radius:12px; background:#ffd87a; color:#000; font-weight:900; text-decoration:none }

    /* Page 3 arri√®re-plan fondu */
    .p3-bg{ position:absolute; inset:0; background-image:url('rolebg.jpg'); background-size:cover; background-position:center; opacity:.25; }
    .p3-overlay{ position:absolute; inset:0; background:linear-gradient(180deg, rgba(7,12,22,.85), rgba(7,12,22,.92)); }
    .p3-content{ position:relative; z-index:2; padding-top:24px; padding-bottom:28px; }
  </style>
</head>
<body>
  <!-- Audio (jou√© au clic ‚ÄúLancez-vous‚Äù) -->
  <audio id="bgm" src="musique.mp3" preload="auto" loop></audio>

  <!-- Bouton secret pour passer l‚Äôintro -->
  <div id="secretFixed" class="secret-fixed" title="Passer l‚Äôintro"></div>

  <!-- PAGE 1 -->
  <section id="p1" class="page show">
    <div class="bg-cover" style="background-image:url('photo1.jpg')"></div>
    <div class="overlay"></div>
    <div class="center-hero wrap">
      <div>
        <h1 class="hero">Vous avez √©t√© convi√©s par Franck‚Ä¶</h1>
        <p class="lead">Un week-end pas comme les autres vous attend.<br>üîä Mettez le son‚Ä¶ car chaque d√©tail compte.</p>
        <div class="sp"></div>
        <button id="startBtn" class="btn" type="button">Lancez-vous</button>
      </div>
    </div>
  </section>

  <!-- PAGE 2 -->
  <section id="p2" class="page">
    <div class="bg-cover" style="background-image:url('chateau.jpg')"></div>
    <div class="overlay"></div>
    <div class="center-hero wrap">
      <div class="panel" style="backdrop-filter: blur(2px);">
        <h2 style="margin:0 0 8px;color:#ffd87a;text-shadow:var(--glow)">Introduction</h2>
        <p class="mut" style="margin:0 0 8px">Tu vas bient√¥t d√©couvrir ton r√¥le.</p>
        <p>Bienvenue ! Vous allez vivre une exp√©rience immersive inspir√©e du jeu des Tra√Ætres. Jouez, discutez, observez‚Ä¶ et faites vos choix. Certains d‚Äôentre vous sont <b>Loyaux</b> (prot√©ger le groupe), d‚Äôautres sont des <b>Tra√Ætres</b> (agir en secret la nuit). Gardons la bonne entente : on est entre amis üòâ</p>
        <div class="sp"></div>
        <div class="center"><button id="enterBtn" class="btn" type="button">Entrer dans le jeu</button></div>
      </div>
    </div>
  </section>

  <!-- PAGE 3 -->
  <section id="p3" class="page">
    <div class="p3-bg"></div>
    <div class="p3-overlay"></div>
    <div class="p3-content">
      <div class="wrap">
        <!-- üîî NOTICE / PLANNING r√©tabli -->
        <section class="panel">
          <h2 class="center" style="color:#ffd98a;text-shadow:var(--glow)">Le d√©roul√© du week-end</h2>
          <p class="center mut">Voici le planning g√©n√©ral ‚Äî on est entre amis, le but est de s‚Äôamuser üòâ</p>
          <div class="grid">
            <div class="card">
              <h3>üóìÔ∏è Le petit planning</h3>
              <ul>
                <li><b>Vendredi soir</b> : conseil et vote d‚Äô√©limination.</li>
                <li><b>Nuit ven ‚Üí sam</b> : les Tra√Ætres choisissent discr√®tement une victime via leur lien.</li>
                <li><b>Samedi matin</b> : annonce au groupe du r√©sultat de la nuit.</li>
                <li><b>Samedi midi</b> : nouveau conseil et vote.</li>
                <li><b>Samedi soir</b> : conseil et vote.</li>
                <li><b>Nuit sam ‚Üí dim</b> : les Tra√Ætres √©liminent √† nouveau via leur lien.</li>
                <li><b>Dimanche matin</b> : annonce au groupe de la victime de la nuit.</li>
              </ul>
            </div>
            <div class="card">
              <h3>üé≠ Esprit & r√®gles</h3>
              <ul>
                <li>Les Tra√Ætres jouent <b>en secret</b> via un lien priv√© (personne ne sait qui ils sont).</li>
                <li>Les Loyaux observent, discutent et votent avec strat√©gie.</li>
                <li>Les √©crans cl√©s s‚Äôaffichent au bon moment pour le groupe.</li>
                <li>Fun & fair-play √† tout moment.</li>
              </ul>
            </div>
          </div>

          <div class="center" style="margin-top:16px">
            <button id="discoverBtn" class="btn" type="button">üîç D√©couvre ton r√¥le</button>
          </div>
        </section>

        <!-- R√¥le -->
        <section id="roleWrap" class="role-wrap">
          <div id="roleBlue" class="role-box role-blue" style="display:none">
            <h3 class="role-title">Ton r√¥le : LOYAL üõ°Ô∏è</h3>
            <p class="role-sub">Observe, discute, vote avec strat√©gie ‚Äî et prot√®ge le groupe.</p>
          </div>
          <div id="roleRed" class="role-box role-red" style="display:none">
            <h3 class="role-title">Ton r√¥le : TRA√éTRE üïµÔ∏è‚Äç‚ôÇÔ∏è</h3>
            <p class="role-sub">Joue en secret. Garde ton lien sous la main pour voter la nuit.</p>
            <div class="role-actions">
              <a id="voteCta" class="cta-traitor" href="#" target="_blank" rel="noopener">Voter la nuit pour √©liminer un Loyal</a>
            </div>
          </div>
        </section>
      </div>
    </div>
  </section>

  <script>
    // ---- audio au clic (navigateurs bloquent l‚Äôautoplay) ----
    (function(){
      var bgm = document.getElementById('bgm');
      function safePlay(){ try{ bgm && bgm.play().catch(()=>{}); }catch(e){} }
      document.getElementById('startBtn').addEventListener('click', safePlay);
    })();

    // ---- navigation entre pages + gestion du bouton secret ----
    const pages = ['p1','p2','p3'].map(id=>document.getElementById(id));
    function setPage(i){
      pages.forEach((p,idx)=>{ if(idx===i) p.classList.add('show'); else p.classList.remove('show'); });
      // cacher le bouton secret sur la page 3
      if(i===2){ document.body.classList.add('hide-secret'); history.replaceState(null,'','#app'); }
      else { document.body.classList.remove('hide-secret'); }
    }
    document.getElementById('startBtn').addEventListener('click', ()=>setPage(1));
    document.getElementById('enterBtn').addEventListener('click', ()=>setPage(2));

    // bouton secret (haut gauche)
    (function(){
      var dot = document.getElementById('secretFixed');
      if(!dot) return;
      dot.addEventListener('click', ()=>setPage(2));
      var t; // long-press tactile
      dot.addEventListener('touchstart', ()=>{ t=setTimeout(()=>setPage(2),600); }, {passive:true});
      dot.addEventListener('touchend', ()=>clearTimeout(t), {passive:true});
    })();

    // ---- helpers token + normalisation r√¥le ----
    function safeAtob(s){
      try { return decodeURIComponent(atob(s)); }
      catch(e){ try { return decodeURIComponent(escape(atob(s))); } catch(e2){ return null; } }
    }
    function parseToken(){
      try{
        const p = new URLSearchParams(location.search||'');
        if(!p.has('t')) return null;
        const raw = p.get('t')||'';
        let decoded = safeAtob(raw);
        if(!decoded){ try{ decoded = decodeURIComponent(raw); }catch(e){} }
        if(!decoded){ try{ decoded = decodeURIComponent(atob(raw)); }catch(e){} }
        if(!decoded) return null;
        return JSON.parse(decoded);
      }catch(e){ return null; }
    }
    function normalizeRole(role){
      if(!role) return '';
      try{
        const s = String(role).toLowerCase();
        return s.normalize ? s.normalize('NFKD').replace(/[\u0300-\u036f]/g,'') : s;
      }catch(e){ return String(role).toLowerCase(); }
    }
    function isTraitorRole(roleVal){
      const r = normalizeRole(roleVal||'');
      return r.includes('trait') || r.includes('traitre') || r.includes('traitor');
    }

    // ---- d√©couverte du r√¥le ----
    (function(){
      const btn = document.getElementById('discoverBtn');
      const wrap = document.getElementById('roleWrap');
      const blue = document.getElementById('roleBlue');
      const red  = document.getElementById('roleRed');
      const voteCta = document.getElementById('voteCta');

      function showRole(){
        const pay = parseToken();
        wrap.style.display='block';
        blue.style.display='none'; red.style.display='none';

        if(pay && pay.role){
          if(isTraitorRole(pay.role)){
            red.style.display='block';
            try{
              const t = new URLSearchParams(location.search).get('t') || '';
              voteCta.href = 'traitor_vote.html' + (t ? ('?t='+encodeURIComponent(t)) : '');
            }catch(e){ voteCta.href = 'traitor_vote.html'; }
          } else {
            blue.style.display='block';
          }
        } else {
          blue.style.display='block';
          blue.querySelector('.role-sub').textContent = "Ouvre ton lien d‚Äôinvitation personnel pour voir ton r√¥le.";
        }
        setTimeout(()=>{ try{ wrap.scrollIntoView({behavior:'smooth', block:'start'}); }catch(e){} }, 50);
      }

      btn.addEventListener('click', showRole);

      // Auto-r√©v√©lation si on recharge d√©j√† √† l'√©tape 3 avec un token
      document.addEventListener('DOMContentLoaded', ()=>{
        const hasT = new URLSearchParams(location.search).has('t');
        if(hasT && (location.hash==='#app' || location.hash==='#role' || location.hash==='#reveal')){
          showRole();
        }
      });
    })();
  </script>
</body>
</html>


