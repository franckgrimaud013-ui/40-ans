<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Les Tra√Ætres ‚Äî Week-end de Franck</title>

<!-- Mobile chrome all black -->
<meta name="theme-color" content="#000000" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#000000" media="(prefers-color-scheme: dark)">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<style>
  html,body{margin:0;height:100%;background:#000;color:#fff;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial}
  html,body{background:#000 !important;color-scheme:dark;overscroll-behavior:none}
  @supports(padding:max(0px)){ body{padding-bottom:env(safe-area-inset-bottom)} }

  /* Video layers */
  #gateScreen{position:fixed;inset:0;z-index:0}
  #gateVideo{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;filter:brightness(.96)}
  #bgVideoLayer{position:fixed;inset:0;z-index:0;opacity:0;transition:opacity 1200ms ease;pointer-events:none}
  .bgv{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;filter:brightness(.9);opacity:0;transition:opacity 3.2s ease-in-out}
  .bgv.is-active{opacity:1}
  .intro-started #bgVideoLayer{opacity:1 !important}
  #blackVeil{position:fixed;inset:0;background:#000;opacity:0;pointer-events:none;z-index:10;transition:opacity 1000ms ease}

  /* Intro panel (top) */
  #gate{position:fixed;inset:0;display:flex;align-items:flex-start;justify-content:center;z-index:6;padding-top:4vh}
  #gate .panel{background:rgba(8,12,16,.86);border-radius:18px;padding:24px 22px;box-shadow:0 10px 40px rgba(0,0,0,.45),0 0 24px rgba(255,215,0,.08);border:1px solid rgba(255,255,255,.08);max-width:min(92vw,1100px)}
  #gate h1{margin:.1em 0 .4em 0;font-size:clamp(22px,5vw,40px);letter-spacing:.02em}
  #gate p{margin:.2em 0 .8em 0;font-size:clamp(16px,2.4vw,20px)}
  @media (max-width:480px){ #gate{padding-top:3vh} }

  /* Paragraphs overlay (2nd scene) */
  .overlay{position:relative;z-index:3;display:none}
  .slide{position:fixed;left:50%;top:12vh;transform:translateX(-50%);width:min(92vw,1100px);text-align:left}
  .slide p{font-size:clamp(18px,2.4vw,28px);line-height:1.35;margin:.9em 0;
    text-shadow:0 0 4px rgba(255,255,255,.35),0 0 12px rgba(255,255,255,.18),0 2px 10px rgba(0,0,0,.55);}
  .slide p.hidden{opacity:0;transform:translateY(.4em);transition:opacity .6s ease, transform .6s ease}
  .slide p.show{opacity:1;transform:none}
  #ctaOverlay{position:fixed;left:0;right:0;bottom:6vh;display:none;justify-content:center;z-index:5}
  .btn{appearance:none;border:1px solid rgba(255,215,0,.7);background:radial-gradient(120% 120% at 50% -10%, rgba(255,215,0,.18), rgba(255,215,0,.06));color:#fff;padding:12px 22px;border-radius:999px;letter-spacing:.04em;text-transform:uppercase;font-weight:700;box-shadow:0 0 22px rgba(255,215,0,.22);cursor:pointer;transition:transform .15s ease, box-shadow .2s ease}
  .btn:hover{transform:translateY(-1px);box-shadow:0 0 28px rgba(255,215,0,.35)}

  /* Rules screen + role video (3rd scene) */
  #roleVideoLayer{position:fixed;inset:0;z-index:1;opacity:0;pointer-events:none;transition:opacity 1200ms ease}
  #rulesScreen{position:fixed;inset:0;display:none;z-index:4;pointer-events:none}
  .rules-wrap{max-width:1100px;margin:0 auto;text-align:center;color:#fff;
    text-shadow:0 0 4px rgba(255,255,255,.35),0 0 12px rgba(255,255,255,.18),0 2px 10px rgba(0,0,0,.55);pointer-events:auto}

  .btn-gold{appearance:none;border:1px solid rgba(255,215,0,.7);
    background:radial-gradient(120% 120% at 50% -10%, rgba(255,215,0,.18), rgba(255,215,0,.06));
    color:#fff;padding:12px 22px;border-radius:999px;letter-spacing:.04em;text-transform:uppercase;
    font-weight:700;box-shadow:0 0 22px rgba(255,215,0,.22);cursor:pointer;transition:transform .15s ease, box-shadow .2s ease}
  .btn-gold:hover{transform:translateY(-1px);box-shadow:0 0 28px rgba(255,215,0,.35)}

  /* Stepper transitions */
  .rule-step{display:none;opacity:0;transform:translateY(12px);transition:opacity .45s ease, transform .45s ease}
  .rule-step.is-active{display:block}
</style>
</head>
<body>

<div id="blackVeil"></div>

<!-- 1) Intro video -->
<section id="gateScreen" aria-label="Intro">
  <video id="gateVideo" autoplay muted playsinline webkit-playsinline preload="auto">
    <source src="videos/intro-gate.mp4" type="video/mp4">
  </video>
</section>

<!-- Intro panel -->
<section id="gate" aria-hidden="false">
  <div class="panel panel--dark">
    <h1 id="p3Title">Vous avez √©t√© convi√©s par Franck‚Ä¶</h1>
    <p>Un week-end pas comme les autres vous attend.<br>üîä <strong>Mettez le son</strong>‚Ä¶ car chaque d√©tail compte.</p>
    <button class="btn" type="button" id="startIntroBtn">Lancez-vous</button>
  </div>
</section>

<!-- 2) Background loop layer (revealed after intro) -->
<div id="bgVideoLayer" aria-hidden="true">
  <video id="bgv1" class="bgv" muted playsinline webkit-playsinline preload="auto">
    <source src="videos/fond-boucle.mp4" type="video/mp4">
  </video>
  <video id="bgv2" class="bgv" muted playsinline webkit-playsinline preload="auto">
    <source src="videos/fond-boucle.mp4" type="video/mp4">
  </video>
</div>

<!-- Paragraphs overlay -->
<div class="overlay">
  <div class="slide" id="slide">
    <p class="hidden">Vous √™tes convi√©s pour un petit week‚Äëend entre amis‚Ä¶ pour c√©l√©brer les 40 ans de Franck.</p>
    <p class="hidden">Un week‚Äëend d‚Äôamiti√©, de rires, de bons repas‚Ä¶ bref, une f√™te comme vous l‚Äôimaginez.</p>
    <p class="hidden">Mais derri√®re cette f√™te se cache un jeu‚Ä¶ discret, mais omnipr√©sent.</p>
    <p class="hidden">On m'a beaucoup parl√© de vous...</p>
    <p class="hidden">Certains tra√Ænent toujours des travaux jamais termin√©s.</p>
    <p class="hidden">D‚Äôautres savent vendre des surgel√©s‚Ä¶ m√™me trop longtemps rest√©s au cong√©lateur.</p>
    <p class="hidden">Il y en a dont les sourcils tombent quand le stress monte.</p>
    <p class="hidden">Et d‚Äôautres ont cette rigueur implacable¬†: les r√®gles‚Ä¶ toutes les r√®gles‚Ä¶ rien que les r√®gles.</p>
    <p class="hidden">Il y en a qui ont l‚Äôart de contredire‚Ä¶ m√™me quand, au fond, c‚Äô√©tait une bonne id√©e.</p>
    <p class="hidden">D‚Äôautres, au contraire, laissent tout glisser‚Ä¶ rien n‚Äôest grave.</p>
    <p class="hidden">Et puis, il y a celui qui n‚Äôaime pas ce type de jeu‚Ä¶ mais qui, ce week‚Äëend, ne pourra pas y √©chapper.</p>
    <p class="hidden">Et bien s√ªr, des infirmi√®res, pr√™tes √† veiller sur chacun‚Ä¶ mais elles aussi devront se m√©fier.</p>
    <p class="hidden">Tout le monde se conna√Æt depuis plusieurs ann√©es‚Ä¶ Mais saurez‚Äëvous reconna√Ætre les tra√Ætres cach√©s parmi vous¬†?</p>
    <p class="hidden">√Ä chaque repas, √† chaque nuit, un conseil d√©cidera d‚Äôun destin.</p>
    <p class="hidden">Vous allez dans quelques instants conna√Ætre vos r√¥les...</p>
    <p class="hidden" id="intro-last">Que la partie commence‚Ä¶</p>
  </div>
</div>
<div id="ctaOverlay"><button id="enterBtn" class="btn">Entrer dans le jeu</button></div>

<!-- 3) Role/Rules scene video background -->
<div id="roleVideoLayer" aria-hidden="true">
  <video id="roleVideo" muted loop playsinline webkit-playsinline preload="auto"
         style="position:absolute;inset:0;width:100%;height:100%;object-fit:cover;filter:brightness(.94)">
    <source src="videos/role-bg.mp4" type="video/mp4">
  </video>
</div>

<!-- Rules screen with stepper -->
<section id="rulesScreen" aria-label="R√®gles">
  <div style="position:absolute;inset:0;display:flex;align-items:center;justify-content:center;padding:10vh 4vw;">
    <div class="rules-wrap">
      <div id="rules-steps">
        <article class="rule-step is-active">
          <h2>Le d√©roul√© du week-end</h2>
          <p>Tu vas bient√¥t d√©couvrir ton r√¥le. Voici comment va se d√©rouler l‚Äôexp√©rience ‚Äî on est entre amis, le but est de s‚Äôamuser üòâ</p>
        </article>
        <article class="rule-step">
          <h3 style="margin:.3em 0 .6em">üìÖ Le planning</h3>
          <ul style="text-align:left; margin:0 auto; max-width:820px; line-height:1.45;">
            <li><strong>Vendredi soir</strong> : conseil et vote d‚Äô√©limination.</li>
            <li><strong>Nuit ven ‚Üí sam</strong> : les Tra√Ætres choisissent discr√®tement une victime via leur lien.</li>
            <li><strong>Samedi matin</strong> : annonce au groupe du r√©sultat de la nuit.</li>
            <li><strong>Samedi midi</strong> : nouveau conseil et vote.</li>
            <li><strong>Samedi soir</strong> : conseil et vote.</li>
            <li><strong>Nuit sam ‚Üí dim</strong> : les Tra√Ætres √©liminent √† nouveau via leur lien.</li>
            <li><strong>Dimanche matin</strong> : annonce au groupe de la victime de la nuit.</li>
          </ul>
        </article>
        <article class="rule-step">
          <h3>üé≠ Esprit & r√®gles</h3>
          <p>Les Tra√Ætres jouent <strong>en secret</strong> via un lien priv√©. Les Loyaux observent, argumentent et votent.</p>
          <p>On reste <strong>fair-play</strong> : on bluffe, on doute, on rit ‚Äî mais tout le monde s‚Äôamuse.</p>
        </article>
        <article class="rule-step">
          <p><strong>Franck ne conna√Æt pas votre r√¥le.</strong></p>
          <p>Pr√™ts ? Alors place au jeu‚Ä¶ et m√©fiez-vous des apparences !</p>
          <button id="discoverBtn" class="btn-gold" style="margin-top:.8em;">D√©couvre ton r√¥le</button>
        </article>
        <div style="margin-top:14px; display:flex; gap:10px; justify-content:center;">
          <button id="rules-next" class="btn-gold" style="padding:.6em 1.2em;">Suivant</button>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Music -->
<audio id="introMusic" preload="auto">
  <source src="musique.mp3" type="audio/mpeg">
</audio>

<script>
// Robust iOS/Safari video unlock
(function(){
  var interacted = false;
  function mark(){ interacted = true; }
  ['touchstart','touchend','click'].forEach(evt => document.addEventListener(evt, mark, {once:true, passive:true}));
})();

function forcePlay(video){
  if (!video) return;
  try{
    video.muted = true;
    video.playsInline = true;
    video.setAttribute('playsinline','');
    video.setAttribute('webkit-playsinline','');
    var p = video.play();
    if (p && p.catch) p.catch(()=>{});
  }catch(e){}
}

// Crossfade loop engine
(function(){
  const layer = document.getElementById('bgVideoLayer');
  const v1 = document.getElementById('bgv1');
  const v2 = document.getElementById('bgv2');
  if (!layer || !v1 || !v2) return;
  const CROSSFADE = 2.8;
  let active = v1, next = v2, armed = false;

  function armLoop(video){
    if (armed) return;
    armed = true;
    const dur = video.duration || 0;
    if (!dur || !isFinite(dur)) {
      video.addEventListener('loadedmetadata', ()=>{ armed=false; armLoop(video); }, {once:true});
      return;
    }
    const tick = () => {
      if (video.paused || video.ended) return;
      const t = video.currentTime;
      if (dur - t <= CROSSFADE + 0.6) {
        try{ next.currentTime = 0; }catch(e){}
        next.play().catch(()=>{});
        active.classList.remove('is-active');
        next.classList.add('is-active');
        const old = active; active = next; next = old;
        armed = false;
        armLoop(active);
      } else {
        requestAnimationFrame(tick);
      }
    };
    requestAnimationFrame(tick);
  }
  window.__bgVideoStart = function start(){
    document.documentElement.classList.add('intro-started');
    try{
      layer.style.opacity = '1';
      v1.currentTime = 0; v2.currentTime = 0;
      forcePlay(v1); // ensure unlocked on iOS
      v2.load();
    }catch(e){}
    v1.classList.add('is-active');
    armLoop(v1);
  }
})();

// Intro flow
(function(){
  const gate = document.getElementById('gate');
  const gateVideo = document.getElementById('gateVideo');
  const veil = document.getElementById('blackVeil');
  const music = document.getElementById('introMusic');
  const slideWrap = document.querySelector('.overlay');
  const ctaWrap = document.getElementById('ctaOverlay');
  const startBtn = document.getElementById('startIntroBtn');

  function startParagraphs(){
    const ps = Array.from(document.querySelectorAll('#slide p'));
    let i = 0;
    function showNext(){
      if (i < ps.length){
        ps[i].classList.remove('hidden');
        ps[i].classList.add('show');
        i++; setTimeout(showNext, 1800);
      } else {
        ctaWrap.style.display='flex';
      }
    }
    slideWrap.style.display = 'block';
    setTimeout(showNext, 600);
  }

  function afterIntro(){
    veil.style.opacity = '1';
    setTimeout(()=>{
      try{ gateVideo.pause(); }catch(e){}
      if (window.__bgVideoStart) window.__bgVideoStart();
      // start music NOW (with 2nd video)
      try{ music.volume=0.35; music.currentTime=0; music.play().catch(()=>{}); }catch(err){}
      gate.style.display='none';
      veil.style.opacity = '0';
      // start paragraphs after loop starts (or fallback)
      const bgv1 = document.getElementById('bgv1');
      let started=false;
      function ok(){ if(started) return; if(bgv1 && bgv1.readyState>=2){ started=true; startParagraphs(); } }
      if (bgv1){ bgv1.addEventListener('loadeddata', ok, {once:true}); bgv1.addEventListener('canplay', ok, {once:true}); }
      setTimeout(()=>{ if(!started){ started=true; startParagraphs(); } }, 1800);
    }, 1000);
  }

  if (startBtn){
    startBtn.addEventListener('click', function(){
      forcePlay(gateVideo);
      // ensure gate video ends even if too short/blocked
      gateVideo.addEventListener('ended', afterIntro, {once:true});
      // si la vid√©o ne part pas, on encha√Æne quand m√™me apr√®s 12s (s√©curit√©)
      setTimeout(()=>{ if (getComputedStyle(gate).display!=='none') afterIntro(); }, 12000);
    });
  }
})();

// Rules Stepper + role video
(function(){
  const steps = Array.from(document.querySelectorAll('#rules-steps .rule-step'));
  const nextBtn = document.getElementById('rules-next');
  const rules   = document.getElementById('rulesScreen');
  const roleLayer = document.getElementById('roleVideoLayer');
  const roleVideo = document.getElementById('roleVideo');
  const enterBtn  = document.getElementById('enterBtn');

  const show = el => { el.classList.add('is-active'); requestAnimationFrame(()=>{ requestAnimationFrame(()=>{ el.style.opacity='1'; el.style.transform='none'; }); }); };
  const hide = el => { el.style.opacity='0'; el.style.transform='translateY(12px)'; setTimeout(()=>{ el.classList.remove('is-active'); el.style.display='none'; }, 320); };

  // init first step visible state
  if (steps.length){ steps[0].style.display='block'; requestAnimationFrame(()=>{ steps[0].style.opacity='1'; steps[0].style.transform='none'; }); }

  let i=0;
  function update(){
    if (i < steps.length-1){
      hide(steps[i]); i++; steps[i].style.display='block'; show(steps[i]);
      if (i === steps.length-1){ nextBtn.style.display='none'; }
    }
  }
  if (nextBtn) nextBtn.addEventListener('click', update);
  document.addEventListener('keydown', e=>{ if(e.key==='Enter'||e.key===' ') update(); });

  // When "Entrer dans le jeu" (from CTA) is clicked, show rules + start role video
  if (enterBtn){
    enterBtn.addEventListener('click', function(){
      rules.style.display='block';
      roleLayer.style.display='block';
      forcePlay(roleVideo);
      requestAnimationFrame(()=>{ requestAnimationFrame(()=>{ roleLayer.style.opacity='1'; }); });
      // hide paragraphs and CTA
      document.querySelector('.overlay').style.display='none';
      document.getElementById('ctaOverlay').style.display='none';
    });
  }

  // Discover button placeholder action
  document.addEventListener('click', function(e){
    if (e.target && e.target.id === 'discoverBtn'){
      // Placeholder: scroll or open your role reveal flow
      alert('Ici, on r√©v√®le le r√¥le (√† brancher).');
    }
  });
})();
</script>
</body>
</html>
