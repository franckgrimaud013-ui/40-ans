<!DOCTYPE html>

<html lang="fr">
<head>
<meta content="#000000" media="(prefers-color-scheme: light)" name="theme-color"/>
<meta content="#000000" media="(prefers-color-scheme: dark)" name="theme-color"/>
<meta content="yes" name="apple-mobile-web-app-capable"/>
<meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"/>
<meta charset="utf-8"/>
<link rel="apple-touch-icon" sizes="180x180" href="icon-512.png">
<link rel="icon" sizes="512x512" href="icon-512.png">
<meta name="apple-mobile-web-app-title" content="Les 40 ans de Franck">
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<title>40 ans Franck</title>
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700;900&amp;family=Playfair+Display:wght@400;700&amp;display=swap" rel="stylesheet"/>
<style>
:root{--fg:#fff;--mut:#cfd5dc;--per:6s;--count:15;--total:calc((var(--per) + 5s)*var(--count) + 0.5s)}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:'Playfair Display',serif;color:var(--fg);background:#000}

/* Fallback si image manquante */
.bg-fallback{background:radial-gradient(ellipse at center,#0a0d12 0%,#05070b 60%,#000 100%)}

/* Arri√®re-plans */
.bg-gate,.bg-intro{
  position:fixed; inset:0;
  background-size:cover; background-position:center;
  z-index:0;opacity:1; transition:opacity 1200ms ease; will-change:opacity;
 background:none; }
.bg-gate{ background-image:url('photo1.jpg'); }
.bg-intro{  opacity:0;  background:none; }
.intro-started .bg-gate{ opacity:0; }
.intro-started .bg-intro{ opacity:1;  background:none; }
.intro-started /* 3e fond : √©cran joueur */
.bg-role{
  position:fixed; inset:0;
  background:none center/cover no-repeat;
  z-index:0; display:none;}
.player-focus .bg-role{ display:block; }
.player-focus .bg-gate, .player-focus .bg-intro{ display:none!important;  background:none; }

/* UI */
.btn{padding:12px 18px;border-radius:14px;font-size:clamp(16px,2.6vw,22px);color:#fff;text-decoration:none;cursor:pointer;
  background:linear-gradient(180deg,rgba(212,175,55,.25),rgba(212,175,55,.12));border:1px solid rgba(212,175,55,.9);
  box-shadow:0 0 0 2px rgba(212,175,55,.15) inset,0 10px 30px rgba(0,0,0,.45),0 0 22px rgba(212,175,55,.35);
  transition:transform .15s ease, box-shadow .15s ease}
.btn:hover{transform:translateY(-2px);box-shadow:0 0 0 2px rgba(212,175,55,.2) inset,0 14px 36px rgba(0,0,0,.5),0 0 28px rgba(212,175,55,.45)}

/* GATE */

#gate .panel{text-align:center}
#gate h1{font-family:Cinzel,serif;margin:0 0 8px 0;font-size:clamp(26px,5vw,40px)}
#gate p{margin:6px 0 14px 0;font-size:clamp(16px,2.5vw,20px);color:var(--mut)}

/* Intro cin√© (d√©marre 2s apr√®s via .intro-text-start) */
.overlay{position:fixed;inset:0;display:none;align-items:center;justify-content:center;padding:20px;z-index:5}
.slide{position:relative;max-width:980px;width:100%;min-height:60vh;display:flex;align-items:center;justify-content:center}
.slide p {
  position:absolute;
  width:min(92%,900px);
  margin:0;
  text-align:center;
  font-size:clamp(22px,4vw,34px);
  line-height:1.6;
  color:#fff; /* blanc lumineux */
  text-shadow:
    0 0 4px rgba(212,175,55,0.9),   /* halo dor√© serr√© */
    0 0 8px rgba(212,175,55,0.6),   /* halo dor√© plus large */
    0 0 12px rgba(0,0,0,0.9);       /* contour sombre pour le contraste */
  opacity:0;
  transform:translateY(8px);
}
@keyframes onebyone{0%{opacity:0;transform:translateY(8px)}10%{opacity:1;transform:none}90%{opacity:1}100%{opacity:0;transform:translateY(-6px)}}
.intro-text-start .slide p{animation:onebyone var(--per) ease-in-out both;animation-delay:calc(var(--i)*var(--per));}
.intro-text-start .overlay{display:flex}

/* CTA apr√®s intro */
#ctaOverlay{position:fixed;inset:0;display:none;align-items:center;justify-content:center;opacity:0;pointer-events:none;z-index:6}
@keyframes enableCTA{to{pointer-events:auto}}
@keyframes fadeCTA{to{opacity:1}}


/* App */
.app{display:none;max-width:1100px;margin:3px auto;padding:5px;position:relative;z-index:7}
#app:target{display:block}
.grid{display:grid;gap:16px}
@media(min-width:980px){.grid{grid-template-columns:1fr 1fr}}
.card{background:rgba(0,0,0,.55);padding:16px;border-radius:14px;border:1px solid rgba(255,255,255,.08)}
.row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.small{font-size:14px;color:var(--mut)} .pill{background:rgba(255,255,255,.08);padding:8px 12px;border-radius:999px}
.inv-row{display:flex;align-items:center;gap:10px;flex-wrap:wrap;justify-content:space-between;border-top:1px solid rgba(255,255,255,.08);padding:10px 0;margin-top:4px}
.inv-left{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.inv-actions{display:flex;gap:8px;align-items:center}
.url-raw{font-size:12px;color:#b9c3cf;word-break:break-all}
.centered{min-height:50vh;display:flex;align-items:center;justify-content:center;text-align:center}
#playerIntro{
  font-size:clamp(20px,4vw,28px);
  text-align:center;
  margin:0 auto;
  line-height:1.5;
  color:#d4af37;
  text-shadow:0 0 6px rgba(0,0,0,.8), 0 0 12px rgba(212,175,55,.5);
}

/* Modale r√¥le */
.modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.75);z-index:9;padding:20px}
.modal .inner{background:#0b0f18;color:#fff;padding:24px;border-radius:16px;max-width:820px;width:100%;max-height:90vh;overflow:auto;border:1px solid rgba(255,255,255,.08)}
.role-title{font-family:Cinzel,serif;font-size:34px;margin:6px 0;display:flex;align-items:center;justify-content:center;gap:12px}
.role-sub{font-size:18px;color:var(--mut)} #roleExtra{font-size:16px;line-height:1.55}
.mask-red{filter:drop-shadow(0 0 8px rgba(255,59,59,.45));color:#ff3b3b}
.mask-blue{filter:drop-shadow(0 0 8px rgba(23,183,255,.45));color:#17b7ff}
#app:target ~ #ctaOverlay{display:none} 
#app:target ~ .overlay{display:none}
#app:target ~ 
#audioUnlock{display:none;position:fixed;left:50%;bottom:18px;transform:translateX(-50%);z-index:9999;background:rgba(0,0,0,.7);color:#fff;padding:10px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.15);backdrop-filter:blur(3px);font-size:14px;white-space:nowrap}
#audioUnlock button{margin-left:8px;padding:6px 10px;border-radius:10px;border:1px solid rgba(212,175,55,.9);background:linear-gradient(180deg,rgba(212,175,55,.25),rgba(212,175,55,.12));color:#fff;cursor:pointer}

/* === Planning & R√®gles (inline) + Role modal (light) + Secret skip === */
.secret-fixed{position:fixed;top:12px;left:12px;width:20px;height:20px;border-radius:50%;z-index:9999;cursor:pointer;opacity:.25;
  background:radial-gradient(circle at 30% 30%, rgba(212,175,55,.95) 0%, rgba(212,175,55,.45) 45%, rgba(0,0,0,0) 60%);
  box-shadow:0 0 14px rgba(212,175,55,.55), 0 0 28px rgba(212,175,55,.35);
}
.app-shown .secret-fixed{display:none}
.welcome-section{margin:14px auto;width:min(92%,960px);background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.12);border-radius:16px;padding:16px;color:#eaf0f8}
.welcome-grid{display:grid;gap:12px}
@media(min-width:760px){.welcome-grid{grid-template-columns:1fr 1fr}}
.wc-card{background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.1);border-radius:14px;padding:12px}
.wc-card h3{margin:0 0 6px;color:#ffd98a}
.wc-card ul{margin:6px 0 0 18px}
.wc-actions{text-align:center;margin-top:10px}
.wc-btn{padding:12px 16px;border:none;border-radius:12px;background:#d4af37;color:#000;font-weight:800;cursor:pointer}
/* Role modal */
.role-modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.75);z-index:12000;padding:16px}
.role-box{background:#0b0f18;border:1px solid rgba(255,255,255,.15);border-radius:16px;padding:18px;width:min(92%,720px);color:#eaf0f8}
.role-box h3{margin:0 0 8px;color:#ffd98a;font-size:clamp(22px,4.2vw,28px)}
.role-main{font-size:clamp(18px,3.5vw,24px);margin-top:6px}
.role-actions{margin-top:12px;text-align:center}
.role-btn{padding:10px 14px;border-radius:12px;border:none;background:#d4af37;color:#000;font-weight:800;cursor:pointer}
/* Role panels (blue/red) */
.role-wrap{margin-top:12px}
.role-box-blue{border-radius:14px;padding:12px;border:1px solid rgba(255,255,255,.15);background:linear-gradient(180deg,#0e2a4d,#12345a)}
.role-box-red{border-radius:14px;padding:12px;border:1px solid rgba(255,255,255,.15);background:linear-gradient(180deg,#5a0f1b,#6e1421)}
.cta-traitor{display:inline-block;padding:10px 14px;border-radius:12px;background:#ffd87a;color:#000;font-weight:900}

/* === Video backgrounds (added) === */
.bgv{ transition:opacity 3.2s ease-in-out; }
.bgv.is-active{ opacity:1 !important; }
.intro-started #bgVideoLayer{ opacity:1 !important; } /* when intro ends, reveal looping layer */

/* === Intro panel pinned to top (override) === */

#gate .panel.panel--dark{ margin-top:0 !important; }
@media (max-width:480px){
  
}

/* Force full black UI chrome and safe dark scheme */
html, body { background:#000 !important; color-scheme: dark; overscroll-behavior: none; }
/* Keep intro panel pinned to top (from prior step) */

#gate .panel.panel--dark{ margin-top:0 !important; }
@media (max-width:480px){
  
}
</style>

<!-- PATCH: lisibilit√© p3 (titre blanc + panneaux sombres) -->
<style id="patch-p3-style">
  /* Titre blanc + halo (sera appliqu√© via JS en ajoutant id="p3Title") */
  #p3Title{
    color:#fff !important;
    font-size:clamp(20px,3.2vw,28px) !important;
    font-weight:900 !important;
    line-height:1.15 !important;
    text-shadow:0 0 14px rgba(255,255,255,.35) !important;
    margin:0 0 10px !important;
  }
  /* Panneaux r√®gles/planning : fond noir semi-transparent */
  .panel-dark{
    background:rgba(0,0,0,.60) !important;
    border:1px solid rgba(255,255,255,.12) !important;
    box-shadow:0 10px 30px rgba(0,0,0,.30) !important;
  }
</style>
<meta content="#000000" name="theme-color"/>
<link href="/icons/icon-192.png" rel="icon"/>
<style>
/* CTA visibility controlled by end of intro animation */
#ctaOverlay{opacity:0;pointer-events:none;transform:translateY(6px);transition:.4s ease;}
</style>
<style id="strict-audio-css">
  #enterGameOverlay{display:none}
  #enterGameOverlay.show{display:flex}
  #bgSoundToggle, #audioUnlock { display:none !important; }
  .bg-gate, .bg-intro { filter:none !important;  background:none; }
  .bg-intro::after, .intro-started </style>
<style id="bg-intro-fix">.bg-intro{background:none!important;}</style>
<style id="bg-video-visibility-fix">
  #bgv1, #bgv2 { position:fixed; inset:0; width:100%; height:100%; display:block; object-fit:cover; z-index:0; background:#000; }
</style>
<style id="p3-stepper-css">
  #p3-steps .step{display:none;opacity:0;transform:translateY(8px);transition:opacity .4s ease,transform .4s ease}
  #p3-steps .step.active{display:block;opacity:1;transform:none}
  #p3-steps .panel{background:rgba(0,0,0,.55);border:1px solid rgba(255,255,255,.10);border-radius:16px;padding:16px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
  #p3-steps h3{margin:0 0 80px;color:#ffd98a;font-size:clamp(20px,4vw,26px)}
  #p3-steps ul{margin:6px 0 0 18px}
  #p3-steps li{line-height:1.5}
  #p3-steps .roleBox{text-align:center;padding:20px 14px}
  #p3-steps .roleTitle{font-family:Cinzel,serif;font-size:clamp(22px,4.4vw,28px);margin:0 0 10px;color:#ffd98a}
  #p3-steps .note{color:#cfd5dc;text-align:center}
</style>
<style id="p3-split-css">
  .layout-split{display:flex; flex-direction:column; min-height:100vh;}
  #p3-steps .step{display:none; opacity:0; transform:translateY(8px); transition:opacity .4s ease, transform .4s ease;}
  #p3-steps .step.active{display:block; opacity:1; transform:none;}
  @media (max-width:520px){
    .layout-split .top-video{flex-basis:28vh; min-height:180px;}
  }
</style>
<style id="p3-simple-css">
  .layout-simple{background:#000;}
  #p3-steps .step{display:none;opacity:0;transform:translateY(8px);transition:opacity .35s ease, transform .35s ease;}
  #p3-steps .step.active{display:block;opacity:1;transform:none;}
  .p3-title {
  margin:10px 0 8px;
  color:#ffd98a;
  font-size:clamp(20px,4.6vw,28px);
  font-family:Cinzel,serif;
  text-align:center;
  width:100%;
}
  .p3-list{margin:8px 0 0 18px;color:#eaeef6}
 .p3-note {
  color:#cfd5dc;
  margin:120px 0px 40px;
  font-size:13px;
  line-height:1.6;
  text-align:center;
  width:100%;
}
  .p3-actions{display:flex;justify-content:center;margin:14px 0 0}
  @media (max-width:520px){
    .top-video{padding-top:6px}
  }
</style>
<meta content="24" name="version"/><style id="p3-topvideo-css">
/* [P3] Petite vid√©o en haut, jamais en plein √©cran */
#welcomeSection .top-video{ max-width:1100px; margin:0 auto; padding-top:10px; }
#welcomeSection .top-video .video-frame{ position:relative; width:100%; aspect-ratio:16/9; background:#000; }
#welcomeSection .top-video .video-frame video.p3-topvid{
  position:absolute; inset:0; width:100%; height:100%;
  object-fit:contain; display:block; background:#000;
}
</style><style id="welcome-removal-css">
/* [Welcome Removal] neutraliser le bloc 'welcome-section' (le grand fond rouge/gris) */
#welcomeSection, .welcome-section, .layout-simple{
  display: contents !important;
  padding: 0 !important;
  margin: 0 !important;
  border: none !important;
  outline: none !important;
  box-shadow: none !important;
  background: transparent !important;
}
</style>

<style id="p3-photo-like-styles">
/* === Photo-like styling for Planning & R√®gles === */
:root{ --gold:#d4af37; }
#p3-steps .p3-photo-title{
  font-family:Cinzel, serif;
  font-weight:900;
  text-align:center;
  color:var(--gold);
  font-size:clamp(26px,5vw,42px);
  margin:6px 0 18px;
  text-decoration:underline;
  text-underline-offset:8px;
  text-decoration-thickness:2px;
}
/* Planning: left labels in gold italics, right text white, dotted leader between */
#p3-steps .plan-list{ list-style:none; padding:0; margin:0; }
#p3-steps .plan-item{ 
  display:flex; align-items:baseline; 
  gap:.2rem; margin:6px 0; 
  font-size:clamp(18px,3.2vw,26px);
  line-height:1.6;
}
#p3-steps .plan-item .left{ 
  color:var(--gold); font-style:italic; white-space:nowrap;
}
#p3-steps .plan-item .dots{ 
  flex:1 1 auto; border-bottom:2px dotted rgba(212,175,55,.85); 
  transform:translateY(-2px); margin:0 .5rem;
}
#p3-steps .plan-item .right{ 
  color:#fff;
}
/* R√®gles: centered white lines, then a gold italic closing line */
#p3-steps .rules-wrap{ text-align:center; }
#p3-steps .rules-wrap p{
  margin:12px auto;
  width:min(92%,920px);
  font-size:clamp(20px,4.4vw,36px);
  line-height:1.6;
  color:#fff;
}
#p3-steps .rules-wrap p.final{
  color:var(--gold);
  font-style:italic;
  font-size:clamp(20px,4.2vw,34px);
  margin-top:18px;
}
/* Card backdrop off (clean black like the photos) */
#welcomeSection .card, #p3-steps .panel, #p3-steps .wc-card{
  background:transparent !important; border:none !important; box-shadow:none !important;
}
</style>

<style id="p3-photo-like-responsive">
/* ===== Mobile tidy (planning & r√®gles) ===== */
@media (max-width: 768px){
  #p3-steps .p3-photo-title{
    font-size: 24px;
    margin: 4px 0 10px;
  }
  /* Make the section use the whole viewport minus button; keep content tidy */
  #p3-s1, #p3-s2{
    display:flex; flex-direction:column;
    min-height: calc(100vh - 300px);
    padding: 0 14px;
  }
  #p3-s1 .plan-list{
    display:grid;
    grid-template-columns: 1fr;
    row-gap: 3px;
    margin: 4px 0 10px;
  }
  #p3-s1 .plan-item{
    display:grid;
    grid-template-columns: 42% 58%;
    column-gap: 10px;
    margin: 0;
    line-height: 1.35;
  }
  #p3-s1 .plan-item .left{
    font-size: 18px;
    font-style: italic;
  }
  #p3-s1 .plan-item .right{
    font-size: 18px;
  }
  #p3-s1 .plan-item .dots{ display:none; }

  /* R√®gles: slightly smaller & tighter */
  #p3-s2 .rules-wrap p{
    width: 100%;
    font-size: 19px;
    line-height: 1.4;
    margin: 10px 0;
  }
  #p3-s2 .rules-wrap p.final{
    font-size: 18px;
  }

  /* Button spacing */
  #p3-steps .p3-actions{ margin: 10px 0 12px; }
}
/* Small phones */
@media (max-width: 380px){
  #p3-s1 .plan-item .left,
  #p3-s1 .plan-item .right{ font-size: 16px; }
  #p3-steps .p3-photo-title{ font-size: 22px; }
}
</style>

<style id="p3-desktop-layout">
/* === Desktop layout for clean two-column planning with dotted leader === */
@media (min-width: 641px){
  #p3-steps .p3-photo-title{
    font-size: clamp(30px, 3.8vw, 44px);
    margin: 10px 0 18px;
  }
  #p3-steps .plan-list{
    width: min(1100px, 92%);
    margin: 0 auto;
  }
  #p3-steps .plan-item{
    display: grid;
    grid-template-columns: minmax(220px, 34%) minmax(20px, 1fr) minmax(360px, 56%);
    align-items: baseline;
    column-gap: 12px;
    margin: 12px 0;
    font-size: clamp(18px, 1.6vw, 24px);
    line-height: 1.5;
  }
  #p3-steps .plan-item .left{ white-space: nowrap; }
  #p3-steps .plan-item .dots{
    border: none;
    height: 2px;
    background: repeating-linear-gradient(
      to right,
      rgba(212,175,55,.95) 0 6px,
      transparent 6px 12px
    );
    transform: translateY(-2px);
  }
  #p3-steps .plan-item .right{ word-break: keep-all; }
  #p3-steps .rules-wrap p{
    width: min(1000px, 90%);
    margin: 12px auto;
    font-size: clamp(20px, 2.4vw, 34px);
    line-height: 1.5;
  }
  #p3-steps .rules-wrap p.final{
    font-size: clamp(20px, 2.2vw, 30px);
  }
}
</style>

<style id="p3-photo-like-styles-mobile">
@media (max-width: 640px){
  #p3-steps .p3-photo-title{
    font-size: 22px;
    margin: 4px 0 10px;
    text-underline-offset:6px;
  }
  /* Stack each line: gold label above white text */
  #p3-steps .plan-list{ padding: 0 2px; }
  #p3-steps .plan-item{
    display:flex;
    flex-direction:column;
    align-items:flex-start;
    margin:1.3px 0;
    line-height:1.35;
    font-size: 18px;
  }
  #p3-steps .plan-item .left{
    margin: 0 0 2px;
    font-size: 18px;
  }
  #p3-steps .plan-item .dots{ display:none; }
  #p3-steps .plan-item .right{
    font-size: 15px;
    margin: 0;
  }
  /* Rules: center text but smaller, tighter */
  #p3-steps .rules-wrap p{
    font-size: 15px;
    line-height: 1.4;
    margin: 20px auto;
    width: 92%;
  }
  #p3-steps .rules-wrap p.final{
    font-size: 17px;
    margin-top: 10px;
  }
  /* Reduce bottom spacing so the button has room */
  #p3-steps .p3-actions{
    margin-top: 8px;
  }
}
</style>


<style id="ios-guide-css">
#iosGuide{position:fixed;inset:0;z-index:9999;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.85);backdrop-filter:blur(4px)}
#iosGuide.show{display:flex}
#iosGuide .box{width:min(92vw,680px);max-height:92vh;background:#0b0b0b;border-radius:14px;overflow:hidden;box-shadow:0 20px 60px rgba(0,0,0,.6);display:grid;grid-template-rows:auto 1fr auto}
#iosGuide header{padding:14px 16px;color:#ffd98a;font-family:Cinzel,serif;font-size:18px;text-align:center;border-bottom:1px solid rgba(255,255,255,.09)}
#iosGuide .content{padding:14px 16px}
#iosGuide ol{list-style:none;margin:0;padding:0;display:grid;gap:14px}
#iosGuide li{display:grid;grid-template-columns:48px 1fr;gap:12px;align-items:center;background:#121212;border:1px solid rgba(255,255,255,.07);border-radius:12px;padding:10px}
#iosGuide .step-idx{width:48px;height:48px;display:grid;place-items:center;border-radius:10px;background:#1a1a1a;color:#ffd98a;font-weight:700;font-size:18px}
#iosGuide .step-txt{color:#e6e6e6;line-height:1.45}
#iosGuide .hint{color:#bfc6cf;font-size:13px;opacity:.85;margin-top:8px;text-align:center}
#iosGuide footer{display:flex;gap:10px;justify-content:center;padding:12px;border-top:1px solid rgba(255,255,255,.09)}
#iosGuide .btn{appearance:none;border:0;border-radius:10px;padding:10px 14px;cursor:pointer}
#iosGuide .btn.primary{background:#ffd98a;color:#1a1a1a;font-weight:700}
#iosGuide .btn.ghost{background:transparent;color:#fff;border:1px solid rgba(255,255,255,.25)}
#iosGuide svg{width:22px;height:22px;vertical-align:-4px;margin-right:6px;opacity:.95}
@media (max-width:480px){#iosGuide .box{width:94vw}}
</style>

<style id="quote-lines-css">.quote-block{color:#e9edf4;margin:60px 0 30px;font-size:14px;line-height:1.75;text-align:center}.quote-block .line{display:block;opacity:0;transform:translateY(6px);animation:quoteLine .55s ease-out forwards}.quote-block .line:nth-child(1){animation-delay:.10s}.quote-block .line:nth-child(2){animation-delay:.45s}.quote-block .line:nth-child(3){animation-delay:.80s}.quote-block .line:nth-child(4){animation-delay:1.15s}.quote-block .cite{font-style:italic;color:#d4af37;text-shadow:0 0 10px rgba(212,175,55,.35)}@keyframes quoteLine{0%{opacity:0;transform:translateY(6px)}100%{opacity:1;transform:none}}</style>
<style id="gate-bottom-css">#gate{position:fixed;inset:0;display:flex;align-items:flex-end;justify-content:center;padding-bottom:8vh;z-index:6}</style>

<style>
.video-frame, .bg-video { position: fixed; inset: 0; z-index: 0; }
.bottom-steps, #p3-steps, .step, .p3-actions { position: relative; z-index: 1; }
</style>


<style>
/* Top banner video sits in normal flow, not fixed */
.p3-topvid, .top-video { position: relative; display: block; width: 100%; height: auto; z-index: 1; }
/* Optional wrapper to maintain height if used */
.p3-top { position: relative; width: 100%; aspect-ratio: 16 / 9; max-height: 40vh; overflow: hidden; }
.p3-top video.p3-topvid { width: 100%; height: 100%; object-fit: cover; display: block; }
/* Ensure the steps/text start below the top video */
#p3-steps, .bottom-steps { margin-top: 12px; position: relative; z-index: 2; }
</style>


<style>
/* Smooth fade to avoid flash when switching videos */
.video-fade { opacity: 0; transition: opacity 400ms ease; background-color:#000; }
.video-fade.is-ready { opacity: 1; }
/* Ensure cover and no layout jump */
video { background:#000; }
</style>


<style>
#antiFlashVeil{
  position:fixed; inset:0; background:#000; opacity:0; pointer-events:none; z-index:9999;
  transition: opacity 160ms linear;
}
#antiFlashVeil.show{ opacity:1; }
</style>


<style id="ios-anti-flash-style">
video#gateVideo, video[src*="intro-gate.mp4"]{
  will-change: opacity;
  backface-visibility: hidden;
}
</style>

</head>
<body><!--
==================== GUIDE RAPIDE (COMMENT MODIFIER) ====================
- PAGE 1 :
  ‚Ä¢ Texte : cherchez le bloc 'Vous avez √©t√© convi√©s‚Ä¶' dans #page1 et modifiez-le.
  ‚Ä¢ Vid√©o d'intro : remplacez src="videos/intro-gate.mp4" par votre fichier si besoin.
  ‚Ä¢ Cacher Page 1 apr√®s clic : cherchez l'ID goPage2 si vous voulez le masquer au clic.

- PAGE 2 :
  ‚Ä¢ Vid√©o principale : src doit √™tre 'videos/fond-boucle-v2.mp4'.
  ‚Ä¢ Bouton 'Entrer dans le jeu' : cherchez l'ID enterGame.
    - Si un script 'timeupdate' existe, vous verrez une constante (ex. SHOW_AT=88). Changez 88 pour modifier le timing d'apparition.
    - Sinon, le bouton peut √™tre toujours visible (ou g√©r√© par un autre script).

- PAGE 3 :
  ‚Ä¢ Petite vid√©o du haut : cherchez .top-video (src='videos/role-bg.mp4').
  ‚Ä¢ √âtapes : #p3-steps avec #p3-s1 / #p3-s2 / #p3-s3.
    - Modifiez le texte des <li> pour changer le planning et les r√®gles.
    - Boutons : #p3-n1 / #p3-n2 (suivant), #p3-b1 / #p3-b2 (pr√©c√©dent).
  ‚Ä¢ Bouton final 'D√©couvre ton r√¥le' : id='p3-revealLink'.
    - Si vous avez une fonction JS 'window.revealRole(window.PAYLOAD)', c‚Äôest ici qu‚Äôelle est appel√©e.
=========================================================================
-->
<div class="secret-fixed" id="secretFixed" title="Passer l\'intro"></div>
<section aria-hidden="true" class="bg-gate" style="position:fixed;inset:0;z-index:0;">
<video autoplay="" id="gateVideo" muted="" playsinline="" preload="auto" style="position:absolute;inset:0;width:100%;height:100%;object-fit:cover;" webkit-playsinline="">
<source src="videos/intro-gate.mp4" type="video/mp4"/>
</video>
</section>
<div aria-hidden="true" class="bg-intro" id="bgVideoLayer" style="position:fixed;inset:0;z-index:0;opacity:0;transition:opacity 1200ms ease;">
<video class="bgv" id="bgv1" muted="" playsinline="" preload="auto" style="position:absolute;inset:0;width:100%;height:100%;object-fit:cover;opacity:1;" webkit-playsinline="">
<source src="videos/fond-boucle-v2.mp4" type="video/mp4"/>
</video>
<video class="bgv" id="bgv2" muted="" playsinline="" preload="auto" style="position:absolute;inset:0;width:100%;height:100%;object-fit:cover;opacity:0;" webkit-playsinline="">
<source src="videos/fond-boucle-v2.mp4" type="video/mp4"/>
</video>
</div>
<div aria-hidden="true" class="bg-role bg-fallback"></div>
<!-- GATE -->
<div id="gate">
<div class="panel">
<!-- Inline handler pour √©viter tout probl√®me de binding -->
<button id="startBtn" class="btn" onclick="startIntro()" type="button" style="display:none">Lancez-vous</button>
</div>
</div>
<!-- INTRO -->
<div class="overlay">
<div class="slide">
</div>
</div>
<!-- CTA apr√®s intro -->
<div id="ctaOverlay"><a class="btn" href="#app">ENTRER DANS LE JEU</a></div>
<!-- APP -->
<div class="app" id="app">
<!-- Planning & R√®gles -->
<!-- ==================== PAGE 3 : PLANNING + ROLE ‚Äî petite vid√©o 'role-bg.mp4' en haut + √©tapes + 'D√©couvre tes r√¥les' ==================== --><section class="welcome-section layout-simple" id="welcomeSection" style="background:#000; padding:0 16px 24px;">
<!-- --- [P3] Petite vid√©o en haut : role-bg.mp4 --- --><!-- [ASTUCE P3] Petite vid√©o en haut (videos/role-bg.mp4). Gardez-la courte/continue. Pour l‚Äôagrandir/r√©duire, ajustez la hauteur/ratio du conteneur .video-frame. --><div class="top-video" style="max-width:1100px;margin:0 auto;padding-top:0px;">
<div class="video-frame" style="position:relative;width:100%;aspect-ratio:16/9;background:#000;">
<video autoplay="" class="p3-topvid" loop="" muted="" playsinline="" preload="auto" style="position:absolute;inset:0;width:100%;height:100%;object-fit:contain;display:block;background:#000;">
<source src="videos/role-bg.mp4?v=24" type="video/mp4"/>
</video>
</div>
</div>
<div class="bottom-steps" style="max-width:980px;margin:14px auto 0;">
<!-- --- [P3] Etapes (planning -> r√®gles -> 'D√©couvre ton r√¥le') --- --><!-- [ASTUCE P3] √âtapes : √©ditez les textes dans #p3-s1 (planning), #p3-s2 (r√®gles), #p3-s3 (intro du bouton final). --><div id="p3-steps">
<!-- ~~~ [P3] ETAPE 1 : Le planning ~~~ --><!-- [ASTUCE P3/S1] Modifiez les <li> pour changer le planning. --><section class="step active" id="p3-s1"><h3 class="p3-photo-title">Planning du jeu</h3><ul class="plan-list"><li class="plan-item"><span class="left">Vendredi soir :</span><span class="dots"></span><span class="right">Premier conseil et vote d‚Äô√©limination.</span></li><li class="plan-item"><span class="left">Nuit vendredi ‚Üí samedi :</span><span class="dots"></span><span class="right">Les Tra√Ætres bannissent un loyal via leur lien.</span></li><li class="plan-item"><span class="left">Samedi matin :</span><span class="dots"></span><span class="right">Annonce au groupe du r√©sultat de la nuit.</span></li><li class="plan-item"><span class="left">Samedi midi :</span><span class="dots"></span><span class="right">Second conseil et vote d‚Äô√©limination.</span></li><li class="plan-item"><span class="left">Samedi soir :</span><span class="dots"></span><span class="right">Troisi√®me conseil et vote d‚Äô√©limination.</span></li><li class="plan-item"><span class="left">Nuit samedi ‚Üí dimanche :</span><span class="dots"></span><span class="right">Les Tra√Ætres √©liminent √† nouveau via leur lien.</span></li><li class="plan-item"><span class="left">Dimanche matin :</span><span class="dots"></span><span class="right">Annonce au groupe de la victime de la nuit.</span></li><li class="plan-item"><span class="left">Dimanche midi :</span><span class="dots"></span><span class="right">Dernier conseil et vote d‚Äô√©limination.</span></li></ul><div class="p3-actions"><button class="btn" id="p3-n1" type="button">Suivant</button></div></section>
<!-- ~~~ [P3] ETAPE 2 : Esprit & r√®gles ~~~ --><!-- [ASTUCE P3/S2] Modifiez ou ajoutez des r√®gles ici. --><section class="step" id="p3-s2"><h3 class="p3-photo-title">Esprit et r√®gles</h3><div class="rules-wrap"><p>Les Tra√Ætres jouent en secret via un lien priv√©.</p><p>Les Loyaux observent, discutent et votent avec strat√©gie.</p><p>Pas de prise de t√™te : les √©crans cl√©s s‚Äôaffichent au bon moment.</p><p>On garde la bonne entente : fun et fair‚Äëplay.</p><p class="final">Les tra√Ætres devront tous √™tre d√©masqu√©s le dimanche midi ;<br/>si ce n‚Äôest pas le cas, les loyaux auront perdu le jeu.</p></div><div class="p3-actions"><button class="btn" id="p3-n2" type="button">Suivant</button></div></section>
<!-- ~~~ [P3] ETAPE 3 : üé≠ D√©couvre ton r√¥le ~~~ --><!-- [ASTUCE P3/S3] Texte avant le bouton final. --><section class="step" id="p3-s3">
<h3 class="p3-title" id="p3-playerLine">Es-tu pr√™t ? Quand tu es seul, d√©couvre ta carte.</h3>
<div class="p3-actions"><!-- ~~~ [P3] Bouton final : üé≠ D√©couvre ton r√¥le (lien / fonction revealRole) ~~~ --><!-- [ASTUCE P3] Si vous avez une fonction revealRole, c'est ici qu'elle est appel√©e. --><a class="btn" href="#" id="p3-revealLink">üé≠ D√©couvre ton r√¥le</a></div>
<p class="p3-note quote-block" id="finalQuote">
  <span class="line">Derri√®re ce sc√©nario, il y a des semaines de travail, d‚Äôimagination et de passion.</span>
  <span class="line">Franck a √©crit, mont√© et fa√ßonn√© chaque image, chaque son, chaque ligne pour vous faire vivre un week‚Äëend unique.</span>
  <span class="line">√Ä pr√©sent, √† vous de jouer‚Ä¶ et d‚Äôaller jusqu‚Äôau bout.</span>
  <span class="line cite">¬´ C‚Äôest le temps que tu as perdu pour ton ami qui fait ton ami si important. ¬ª ‚Äî Antoine de Saint‚ÄëExup√©ry</span>
</p>

<style>
/* Effet cin√©ma de fin (sans audio) */
.cinema-fade {
  opacity: 0;
  transform: translateY(20px);
  animation: fadeInCine 3s ease-out 1.5s forwards;
  font-size: 14px;
  line-height: 1.8;
  text-align: center;
  color: #cfd5dc;
  margin: 100px 0 40px;
}

.cinema-fade .quote {
  display: block;
  margin-top: 20px;
  font-style: italic;
  color: #d4af37;
  opacity: 0;
  transform: scale(0.98);
  animation: glowQuote 4s ease-out 3s forwards;
}

@keyframes fadeInCine {
  0% { opacity: 0; transform: translateY(20px) scale(0.98); }
  60% { opacity: 1; transform: translateY(0) scale(1.02); }
  100% { opacity: 1; transform: translateY(0) scale(1); }
}

@keyframes glowQuote {
  0% { opacity: 0; text-shadow: none; }
  40% { opacity: 1; text-shadow: 0 0 10px rgba(212,175,55,0.4); }
  100% { opacity: 1; text-shadow: 0 0 18px rgba(212,175,55,0.35); }
}
</style>
</section>
</div>
</div>
</section>
</div>
</div>
</div>
<!-- Modale r√¥le -->
<div aria-hidden="true" class="modal" id="roleModal">
<div class="inner" id="roleInner">
<div class="role-title" id="roleTitle">Votre r√¥le</div>
<div class="role-sub" id="roleSub"></div>
<div id="roleExtra" style="margin-top:12px"></div>
<div style="text-align:center;margin-top:16px">
<button class="btn" id="closeRoleBtn" style="font-size:18px">Fermer</button>
</div>
</div>
</div>
<audio id="introMusic" playsinline="" preload="auto">
<source src="audio/fond-boucle-v2.mp3" type="audio/mpeg"/>
</audio>
<div id="audioUnlock">üîä Le son est bloqu√©. <button id="unlockBtn">Activer le son</button></div>
<!-- ==================== SCRIPTS (navigation, timings vid√©o, r√¥le, etc.) ==================== --><script>
function parseToken(){try{var p=new URLSearchParams(location.search||'');if(p.has('t')){return JSON.parse(decodeURIComponent(atob(p.get('t'))));}}catch(e){} return null;}
var PAYLOAD=null;

/* D√©marrage intro */
function startIntro(){
  try{
    document.documentElement.classList.add('intro-started');
    var gate=document.getElementById('gate'); if(gate) gate.style.display='none';

    var v1=document.getElementById('bgv1');
    var v2=document.getElementById('bgv2');
    var audio=document.getElementById('introMusic');
    var auEl=document.getElementById('audioUnlock');

    // Pr√©parer les horloges au temps 0
    if (v1){ try{ v1.muted = true; v1.currentTime = 0; }catch(e){} }
    if (v2){ try{ v2.muted = true; v2.currentTime = 0; }catch(e){} }
    if (audio){ try{ audio.loop = true; audio.volume = 0.35; audio.currentTime = 0; }catch(e){} }

    // Lancer d'abord les vid√©os (ma√Ætre), puis l'audio
    var plays = [];
    if (v1) plays.push(v1.play().catch(()=>{}));
    if (v2) plays.push(v2.play().catch(()=>{}));
    Promise.all(plays).then(function(){
      if (!audio) return;
      var p = audio.play();
      if (p && typeof p.then === 'function'){
        p.then(function(){ if(auEl) auEl.style.display='none'; })
         .catch(function(){ if(auEl) auEl.style.display='block'; });
      }
    });

    // Recalage p√©riodique : on aligne l'audio sur v1 si |drift| > 40 ms
    function masterTime(){
      if (!v1) return null;
      try { return v1.currentTime; } catch(e){ return null; }
    }
    function resync() {
  if (!audio || audio.paused) return;
  const vt = masterTime();
  if (vt == null || !isFinite(vt)) return;

  let at = 0;
  try { at = audio.currentTime; } catch (e) { return; }

  const d = vt - at;

  if (Math.abs(d) > 0.05) {
    try { audio.currentTime = vt; } catch (e) {}
    try { audio.playbackRate = 1.0; } catch (e) {}
  } else if (Math.abs(d) > 0.015) {
    const r = 1 + (d * 0.02);
    try { audio.playbackRate = Math.max(0.98, Math.min(1.02, r)); } catch (e) {}
  } else {
    try { audio.playbackRate = 1.0; } catch (e) {}
  }
}

      if (window.__syncTimer) {
  clearInterval(window.__syncTimer);
  window.__syncTimer = null;
}
window.__syncTimer = setInterval(resync, 250);
// Lancement du texte inchang√© (2s)
    setTimeout(function(){
      document.documentElement.classList.add('intro-text-start');
    }, 2000);

  }catch(e){ console.error(e); alert('Erreur de d√©marrage'); }

    // Affichage du CTA quand la 2e vid√©o (bgv1) atteint 28s
    (function(){
      var CTA_AT = 28;
      var v1 = document.getElementById('bgv1');
      var cta = document.getElementById('ctaOverlay');
      if (!v1 || !cta) return;
      // S√©curit√©s: rester cach√© par d√©faut
      cta.style.display = 'none';
      cta.style.opacity = '0';
      cta.style.pointerEvents = 'none';
      function showCTA(){
        if (cta.dataset.shown === '1') return;
        cta.dataset.shown = '1';
        cta.style.display = 'flex';
        requestAnimationFrame(function(){
          cta.style.opacity = '1';
          cta.style.pointerEvents = 'auto';
          cta.style.transform = 'none';
        });
        v1.removeEventListener('timeupdate', onTick);
      }
      function onTick(){
        try{
          if (v1.currentTime >= CTA_AT) showCTA();
        }catch(e){}
      }
      // Si on recharge et qu'on est d√©j√† au-del√†
      try{ if (v1.currentTime >= CTA_AT) showCTA(); }catch(e){}
      v1.addEventListener('timeupdate', onTick);
    })();
}

/* Mode joueur */
function onEnterApp(){
  try{
    if (PAYLOAD){
      document.documentElement.classList.add('player-focus');
      var cta=document.getElementById('ctaOverlay'); if(cta) cta.style.display='none';
      var org=document.getElementById('orgCard'); if(org) org.style.display='none';
      var pIntro=document.getElementById('playerIntro'); 
      if(pIntro && PAYLOAD.name){
        pIntro.innerHTML = "<b>"+PAYLOAD.name+"</b>, es-tu pr√™t ? Quand tu es seul, d√©couvre ta carte.<br>" +
                           "<span style='color:#ccc;font-size:18px'>Petit secret : c‚Äôest bien Franck qui a eu l‚Äôid√©e de ce jeu üòâ‚Ä¶ mais rassurez-vous, il ne conna√Æt pas vos r√¥les.</span>";
      }
      var playerName=document.getElementById('playerName'); if(playerName && PAYLOAD.name){ playerName.textContent = PAYLOAD.name; }
      var center=document.getElementById('playerCenter'); if(center) center.style.display='flex';
      var btn=document.getElementById('revealBtn');
      if(btn && !btn._bound){
        btn._bound=true;
        btn.addEventListener('click', function(){ revealRole(PAYLOAD); });
      }
    }
  }catch(e){ console.error(e); }
}
function onHashChange(){ if (location.hash==="#app"){ onEnterApp(); } }
window.addEventListener('hashchange', onHashChange);

/* Init + invitations */
document.addEventListener('DOMContentLoaded', function(){
  try{
    PAYLOAD=parseToken();
    if (location.hash==="#app"){ onEnterApp(); }


    
  }catch(e){ console.error(e); }
});

/* Modale r√¥le */
function revealRole(payload){
  var modal=document.getElementById('roleModal'); var inner=document.getElementById('roleInner'); var title=document.getElementById('roleTitle'); var sub=document.getElementById('roleSub'); var extra=document.getElementById('roleExtra');
  modal.style.display='flex';
  if(payload.role==='TRAITRE'){
    inner.style.background='linear-gradient(180deg,#4a0b0b,#220606)';
    title.innerHTML='<span class="mask-red">üé≠</span> TRA√éTRE'; title.style.color='#fff';
    var q=payload.codeQ||"Quelle heure est-il ?"; var a=payload.codeA||"11h23";
    sub.innerHTML='Ton objectif est d‚Äô√©liminer les Loyaux sans te faire d√©masquer.<br><br>' +
      'Pour reconna√Ætre tes alli√©s tra√Ætres, tu disposes d‚Äôune <b>consigne secr√®te</b> :<br>' +
      '<b>Question :</b> ¬´ '+q+' ¬ª<br>' +
      '<b>R√©ponse :</b> ¬´ '+a+' ¬ª (m√™me si c‚Äôest faux).<br><br>' +
      'üëâ Tu peux soit <b>poser toi-m√™me la question</b> pour tester quelqu‚Äôun,<br>' +
      'üëâ soit <b>r√©pondre avec le code</b> si on te la pose.';
    extra.innerHTML='<ul style="margin:6px 0 8px 18px">\
<li><b>Conseils (apr√®s repas)</b> : d√©bats + vote ‚Üí 1 joueur √©limin√©.</li>\
<li><b>Nuits (ven & sam)</b> : les tra√Ætres √©liminent un Loyal.</li>\
<li><b>Jeu</b> : reste cr√©dible, √©vite les certitudes trop rapides.</li>\
<li><b>Discr√©tion</b> : ne r√©v√®le jamais ton r√¥le ni ton √©cran.</li>\
</ul>\
<div style="margin-top:6px;color:#f2b3b3"><b>‚ö†Ô∏è Ne r√©v√®le jamais ton code directement, utilise-le subtilement.</b></div>';
  } else {
    inner.style.background='linear-gradient(180deg,#0b1f4a,#061022)';
    title.innerHTML='<span class="mask-blue">üé≠</span> LOYAL'; title.style.color='#fff';
    sub.innerHTML='Ton r√¥le : observer, discuter et <b>d√©masquer les tra√Ætres</b>.';
    extra.innerHTML='<ul style="margin:6px 0 0 18px">\
<li><b>Conseils (apr√®s repas)</b> : d√©bats + vote ‚Üí 1 √©limin√©.</li>\
<li><b>Nuits</b> : seuls les tra√Ætres agissent (√©limination d‚Äôun Loyal).</li>\
<li><b>Indices</b> : incoh√©rences, alliances soudaines, votes √©tranges‚Ä¶</li>\
<li><b>Strat√©gie</b> : construis une histoire coh√©rente, ne te fie pas qu‚Äôaux apparences.</li>\
</ul>';
  }
  document.getElementById('closeRoleBtn').onclick=function(){ modal.style.display='none'; };
}
</script>
<script>
// Secret skip intro: go straight to #app
(function(){
  var dot = document.getElementById('secretFixed');
  function showApp(e){
    if (e && e.preventDefault) e.preventDefault();
    try { startMainStage(); } catch (err) { console.error(err); }
  }
  if (dot){
    var t;
    dot.addEventListener('click', showApp, {passive:false});
    dot.addEventListener('touchstart', function(){ t = setTimeout(showApp, 600); }, {passive:true});
    dot.addEventListener('touchend', function(){ clearTimeout(t); }, {passive:true});
  }
  document.addEventListener('DOMContentLoaded', function(){
    if (location.hash === '#app'){ document.documentElement.classList.add('app-shown'); }
  });
})();// Role reveal (inline first; modal fallback if no inline container)
(function(){
  function parseToken(){
    try{
      var p = new URLSearchParams(location.search||'');
      if(p.has('t')) return JSON.parse(decodeURIComponent(atob(p.get('t'))));
    }catch(e){}
    return null;
  }
  function openInline(){
    var wrap = document.getElementById('roleInline');
    var blue = document.getElementById('roleBlue');
    var red  = document.getElementById('roleRed');
    var voteCta = document.getElementById('voteCta');
    if(!wrap) return false;
    var pay = parseToken();
    wrap.style.display='block';
    blue.style.display='none'; red.style.display='none';
    if(pay && pay.role==='TRAITRE'){
      red.style.display='block';
      var t = new URLSearchParams(location.search).get('t') || '';
      if(voteCta){ voteCta.href = 'traitor_vote.html' + (t ? ('?t='+encodeURIComponent(t)) : ''); }
    } else if(pay && pay.role){
      blue.style.display='block';
    } else {
      // No token: keep the inline panels hidden, use modal instead to show message
      wrap.style.display='none';
      return false;
    }
    // scroll to panels
    try{ document.getElementById('roleInline').scrollIntoView({behavior:'smooth', block:'start'}); }catch(e){}
    return true;
  }
  function openModal(){
    var wrap = document.getElementById('roleModal');
    var box  = document.getElementById('roleContent');
    if(!wrap || !box) return;
    var pay = parseToken();
    if(pay && pay.role){
      var name = pay.name || 'Joueur';
      var role = pay.role;
      var emoji = role==='TRAITRE' ? 'üïµÔ∏è‚Äç‚ôÇÔ∏è' : 'üõ°Ô∏è';
      box.innerHTML = '<div>'+emoji+' <b>'+name+'</b>, ton r√¥le est :</div><div style="margin-top:8px;font-size:1.2em"><b>'+role+'</b></div>';
    } else {
      box.innerHTML = "üîí Ce lien ne contient pas ton r√¥le. Ouvre d‚Äôabord ton lien d‚Äôinvitation personnel.<br><span style='font-size:14px;color:#cfd5dc'>L‚Äôorganisateur doit d‚Äôabord cr√©er et envoyer les invitations.</span>";
    }
    wrap.style.display='flex';
  }
  function closeModal(){ var wrap=document.getElementById('roleModal'); if(wrap) wrap.style.display='none'; }
  document.addEventListener('DOMContentLoaded', function(){
    var btn = document.getElementById('gotoReveal');
    if(btn && !btn._b){ btn._b=true; btn.addEventListener('click', function(){ if(!openInline()) openModal(); }); }
    var c = document.getElementById('roleClose');
    if(c && !c._b){ c._b=true; c.addEventListener('click', closeModal); }
  });
})();
</script>
<!-- PATCH v7: remplace #closeRoleBtn par un lien "Voter la nuit..." pour les Tra√Ætres -->

<script>
(function(){
  // S√©lecteurs robustes par src si pas d'ID
  function qsIntro(){ return document.querySelector('audio[src*="fond-boucle-v2.mp3"]'); }
  function qsBG(){ return document.querySelector('audio[src*="musique.mp3"]'); }

  var introA = qsIntro();
  var bgA = qsBG();

  if(introA){ introA.autoplay=false; try{ introA.pause(); introA.currentTime=0; }catch(e){} }
  if(bgA){ bgA.autoplay=false; try{ bgA.pause(); bgA.currentTime=0; }catch(e){} }

  var __introPlayed=false, __bgPlayed=false;

  var _startIntro = window.startIntro;
  window.startIntro = function(){
    if(typeof _startIntro==='function') _startIntro();

    introA = qsIntro(); bgA = qsBG(); // re-r√©cup√©rer si le DOM a chang√©
    if(introA && !__introPlayed){
      try{ introA.currentTime=0; introA.play(); __introPlayed=true; }catch(e){}
    }
    if(bgA){
      try{ bgA.pause(); bgA.currentTime=0; }catch(e){}
    }
  };

  function onEnterGame(){
    introA = qsIntro(); bgA = qsBG();
    if(introA){ try{ introA.pause(); }catch(e){} }
    if(bgA && !__bgPlayed){
      try{ bgA.currentTime=0; bgA.play(); __bgPlayed=true; }catch(e){}
    }
  }

  // Cible probable: bouton dans #ctaOverlay
  var ov = document.getElementById('ctaOverlay');
  if(ov){
    ov.addEventListener('click', function(e){
      var btn = e.target.closest('button');
      if(btn){ onEnterGame(); }
    });
  }else{
    document.addEventListener('click', function(e){
      var btn = e.target.closest('button[data-action="enter-game"], button#enterBtn, button#enterGameBtn');
      if(btn){ onEnterGame(); }
    });
  }

  // En cas de rechargement / navigation interne, s'assurer que la musique BG est bien √† l'arr√™t tant que le jeu n'est pas entr√©
  if(bgA){ try{ bgA.pause(); bgA.currentTime=0; }catch(e){} }
})();
</script>
</body>
</html>
