<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Annonce — Révélation auto (médiévale + prologue)</title>
  <!-- Fonts médiévales -->
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700;900&family=Cormorant+Garamond:wght@400;600&display=swap" rel="stylesheet">
  <!-- Firebase compat SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
  <style>
    :root{
      --bg:#090e18; --ink:#f3efe6; --mut:#c9c2b5; --gold:#e9d28f;
      /* Remplace par des photos si tu veux */
      --bg1: radial-gradient(1200px 700px at 30% -10%, rgba(233,210,143,.15), transparent 60%), #0b0f18;
      --bg2: radial-gradient(1000px 600px at 70% 120%, rgba(170,153,255,.12), transparent 60%), #0a0d14;
      --bg3: radial-gradient(1400px 800px at 50% -20%, rgba(255,153,170,.10), transparent 60%), #0a0b12;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--ink);font-family:'Cormorant Garamond', serif;overflow:hidden}

    /* Fullscreen overlay */
    .overlay{position:fixed; inset:0; display:flex; align-items:center; justify-content:center; z-index:9999; color:#fff; text-align:center;}
    .overlay .inner{position:relative; width:100%; max-width:1100px; padding:24px}

    /* Background crossfade (3 layers) */
    .bgstage{position:fixed; inset:0; z-index:0; pointer-events:none; overflow:hidden}
    .bgslide{position:absolute; inset:0; background-size:cover; background-position:center; opacity:0}
    .bg1{background:var(--bg1); animation:fade 9s linear infinite; }
    .bg2{background:var(--bg2); animation:fade 9s linear infinite 3s;}
    .bg3{background:var(--bg3); animation:fade 9s linear infinite 6s;}
    @keyframes fade{ 0%{opacity:0} 7%{opacity:.8} 40%{opacity:.95} 70%{opacity:.8} 100%{opacity:0} }

    /* Prologue (slides de texte qui s'enchaînent) */
    .prologue-wrap{position:relative; min-height:22vh; margin:0 0 10px}
    .slide{position:absolute; inset:0; display:flex; align-items:center; justify-content:center; opacity:0; transition:opacity .9s ease}
    .slide.active{opacity:1}
    .prol1{font-family:'Cinzel', serif; font-weight:900; letter-spacing:.04em; font-size:clamp(22px,3.8vw,42px); color:var(--gold);
      text-shadow:0 0 18px rgba(233,210,143,.28)}
    .prol2,.prol3{font-size:clamp(18px,2.8vw,28px); color:var(--ink)}

    /* Countdown + Nom */
    .countdown{font-family:'Cinzel', serif; font-size:clamp(64px,14vw,200px); line-height:.9; font-weight:900; letter-spacing:6px;
      margin:12px 0 16px; text-shadow:0 0 50px rgba(233,210,143,.35); display:none}
    .name{font-family:'Cinzel', serif; display:none; font-size:clamp(52px,12vw,160px); line-height:.95; font-weight:900; text-transform:uppercase;
      color:var(--gold); letter-spacing:.04em; text-shadow:0 0 55px rgba(233,210,143,.45)}

    .note{color:var(--mut); margin-top:8px; font-size:clamp(14px,2vw,18px)}

    /* Discrets boutons utilitaires (replay/refresh) */
    .bar{position:fixed; left:12px; bottom:12px; z-index:10000; display:flex; gap:8px; opacity:.25}
    .btn{background:var(--gold); color:#000; border:none; border-radius:12px; padding:10px 14px; font-weight:900; cursor:pointer}
    .btn-ghost{background:rgba(255,255,255,.08); color:#fff; border:1px solid rgba(255,255,255,.18)}

    #status{position:fixed; top:10px; right:10px; font-size:13px; color:var(--mut); z-index:10001}
  </style>
</head>
<body>

<!-- === BACKGROUND VIDEO (plein écran, sans voile) === -->
<div id="bgVideoWrap" aria-hidden="true">
  <video id="bgVoteVideo" autoplay muted loop playsinline webkit-playsinline preload="auto">
    <source src="videos/vote-bg.mp4" type="video/mp4">
  </video>
</div>
<!-- === /BACKGROUND VIDEO === -->

>
  <!-- Fond en fondu -->
  <div class="bgstage" aria-hidden="true">
    <div class="bgslide bg1"></div>
    <div class="bgslide bg2"></div>
    <div class="bgslide bg3"></div>
  </div>

  <!-- Overlay -->
  <div id="overlay" class="overlay" aria-live="polite">
    <div class="inner">
      <div class="prologue-wrap" id="prologue">
        <div class="slide" id="s1"><div class="prol1">Les Traîtres ont encore frappé cette nuit…</div></div>
        <div class="slide" id="s2"><div class="prol2">La maison murmure des secrets.</div></div>
        <div class="slide" id="s3"><div class="prol3">Dans un instant, vous saurez qui a été éliminé.</div></div>
      </div>
      <div id="cd" class="countdown">5</div>
      <div id="name" class="name">—</div>
      <p class="note">Touchez l’écran pour fermer la révélation.</p>
    </div>
  </div>

  <div class="bar" aria-hidden="true">
    <button id="replay" class="btn-ghost">Rejouer</button>
    <button id="reload" class="btn-ghost">Rafraîchir</button>
  </div>
  <div id="status">Initialisation…</div>

  <script>
    // ---- Firebase config ----
    const firebaseConfig = {
      apiKey: "AIzaSyAu4zFpNXwSTSVsw4PZSZ4zKnIGejKRxFo",
      authDomain: "ans-de-franck.firebaseapp.com",
      databaseURL: "https://ans-de-franck-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "ans-de-franck",
      storageBucket: "ans-de-franck.firebasestorage.app",
      messagingSenderId: "1063437612417",
      appId: "1:1063437612417:web:812e847dfcd990c6922480"
    };
    let app=null, db=null;
    try { app = firebase.initializeApp(firebaseConfig); } catch(e){}
    try { db = firebase.database(); } catch(e){ db=null; }

    const $ = (s)=>document.querySelector(s);
    const statusEl = $('#status');
    const cd = $('#cd');
    const nm = $('#name');

    function todayISO(){
      const dt = new Date();
      const y = dt.getFullYear(), m = String(dt.getMonth()+1).padStart(2,'0'), d = String(dt.getDate()).padStart(2,'0');
      return y+'-'+m+'-'+d;
    }
    function groupCounts(votes){
      const map = new Map();
      votes.forEach(v=>{
        const name = (v && v.victim) ? String(v.victim).trim() : '';
        if(!name) return;
        map.set(name, (map.get(name)||0)+1);
      });
      return Array.from(map.entries()).sort((a,b)=> b[1]-a[1]);
    }
    async function fetchTopName(){
      const date = todayISO();
      statusEl.textContent = 'Chargement des votes ('+date+')…';
      if(!db){ statusEl.textContent = '❌ Firebase non configuré.'; return ''; }
      const snap = await db.ref('/nights/'+date+'/votes').once('value');
      if(!snap.exists()){ statusEl.textContent = 'Aucun vote pour l’instant.'; return ''; }
      const v = snap.val();
      const arr = Object.keys(v||{}).map(k=>v[k]);
      const counts = groupCounts(arr);
      statusEl.textContent = 'Prêt.';
      return counts.length ? counts[0][0] : '';
    }

    // Slides de prologue (fade-in/out)
    const slides = ['#s1','#s2','#s3'].map(sel=>$(sel));
    const SLIDE_MS = 2500; // durée d'affichage de chaque slide (ms)

    function runPrologue(next){
      let i = 0;
      function show(idx){
        slides.forEach((el,j)=> el.classList.toggle('active', j===idx));
      }
      show(0);
      const t1 = setTimeout(()=>{ show(1); }, SLIDE_MS);
      const t2 = setTimeout(()=>{ show(2); }, SLIDE_MS*2);
      const t3 = setTimeout(()=>{ slides[2].classList.remove('active'); next(); }, SLIDE_MS*3);
      return [t1,t2,t3];
    }

    function playCountdown(name){
      cd.style.display='block';
      nm.style.display='none';
      let n = 5;
      cd.textContent = n;
      const timer = setInterval(()=>{
        n--;
        if(n>0){
          cd.textContent = n;
        } else {
          clearInterval(timer);
          cd.style.display='none';
          nm.textContent = name || '—';
          nm.style.display='block';
        }
      }, 1000);
      return timer;
    }

    async function startAuto(){
      const top = await fetchTopName();
      runPrologue(()=> playCountdown(top));
    }

    document.addEventListener('DOMContentLoaded', startAuto);

    // Fermer l'overlay au toucher/clic
    $('#overlay').addEventListener('click', ()=>{ $('#overlay').style.display='none'; });

    // Outils cachés
    $('#replay').addEventListener('click', async ()=>{
      $('#overlay').style.display='flex';
      // reset prologue state
      slides.forEach(el=>el.classList.remove('active'));
      const top = await fetchTopName();
      runPrologue(()=> playCountdown(top));
    });
    $('#reload').addEventListener('click', ()=>location.reload());
  </script>

<!-- Garder la vidéo visible pendant le compte à rebours -->
<style id="keep-video-overlays-transparent">
  /* La vidéo plein écran derrière tout */
  #bgVideoWrap { position: fixed; inset: 0; z-index: 0; pointer-events: none; }
  #bgVoteVideo { position: absolute; inset: 0; width: 100%; height: 100%; object-fit: cover; }

  /* Le contenu utile passe au-dessus */
  #app, main, .container, .wrap, .page, .content, #root, #__next {
    position: relative; z-index: 1; background: transparent !important;
  }

  /* Le calque overlay et ses blocs n'ont AUCUN fond */
  #overlay { position: relative; z-index: 1; background: transparent !important; }
  #overlay::before, #overlay::after { background: transparent !important; }
  #overlay .inner, #overlay .slide, #overlay .countdown, #cd, #overlay .bar {
    background: transparent !important; box-shadow: none !important;
  }

  /* Neutralise des anciens fonds statiques éventuels */
  .bgstage, .bgslide, #bg-role, .bg-fallback, .bg-intro {
    display: none !important; opacity: 0 !important; pointer-events: none !important;
  }

  /* Base */
  html, body { background: #000; margin: 0; }
</style>


<style id="name-top-white">
  /* Nom du joueur : blanc, en haut, centré, même taille */
  #overlay .name, .name {
    color: #ffffff !important;
    position: absolute !important;
    top: 5vh !important;
    left: 50% !important;
    transform: translateX(-50%) !important;
    z-index: 5 !important;
    text-align: center;
    /* on ne touche pas à font-size / font-weight pour garder la même taille */
  }
</style>


<style id="final-tweaks">
  :root { --mask-scale: 0.5; } /* 50% */
  /* 1) "Les traîtres..." en blanc pur */
  .announcement h1 {
    color:#ffffff !important;
    -webkit-text-fill-color:#ffffff !important;
    text-shadow:none !important;
  }
  /* 2) Les deux autres phrases +70% */
  .announcement h2,
  .announcement p {
    font-size: 170% !important; /* +70% */
    line-height: 1.15 !important;
  }
  /* 3) Masque deux fois plus petit (robuste : attrape id/class contenant 'mask') */
  [id*="mask"],
  [class*="mask"] {
    transform: scale(var(--mask-scale)) !important;
    transform-origin: center center !important;
  }
  [class*="mask"] img,
  [class*="mask"] video {
    max-width: 50% !important;
    height: auto !important;
  }
</style>

</body>
</html>


