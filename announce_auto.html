<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Annonces du matin (corrigée)</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
  <style>
    body {
      font-family: system-ui, -apple-system, sans-serif;
      background: #0b0f18;
      color: #fff;
      text-align: center;
      padding: 40px 10px;
    }
    h1 { color: #ffd87a; }
    input, button {
      padding: 10px 16px;
      border-radius: 8px;
      border: none;
      margin: 8px;
      font-size: 16px;
    }
    button {
      background: #ffd87a;
      color: #000;
      cursor: pointer;
      font-weight: bold;
    }
    #result { margin-top: 20px; font-size: 1.2em; }
    #ver { margin-top:10px;color:#9fd29f;font-size:14px }
    #fbStatus { color:#ccc;font-size:14px;margin-top:4px }
  </style>
</head>
<body>
  <h1>Annonces du matin</h1>
  <div id="ver">Version corrigée finale</div>
  <div id="fbStatus"></div>
  <p>Entrez la date (AAAA-MM-JJ) pour voir la victime :</p>
  <input type="text" id="dateInput" placeholder="2025-10-05">
  <button id="showBtn">Afficher</button>
  <label><input type="checkbox" id="autoRefresh"> Rafraîchissement automatique</label>
  <div id="result"></div>

  <script>
  // ---------- CONFIG FIREBASE ----------
  const firebaseConfig = {
  apiKey: "AIzaSyAu4zFpNXwSTSVsw4PZSZ4zKnIGejKRxFo",
  authDomain: "ans-de-franck.firebaseapp.com",
  databaseURL: "https://ans-de-franck-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "ans-de-franck",
  storageBucket: "ans-de-franck.firebasestorage.app",
  messagingSenderId: "1063437612417",
  appId: "1:1063437612417:web:812e847dfcd990c6922480"
};

  // Initialisation compat
  try { firebase.initializeApp(firebaseConfig); } catch(e) {}
  let db;
  try { db = firebase.database(); } catch(e) { db = null; }

  // Vérifie l'état Firebase
  (function(){
    const fbStatus = document.getElementById('fbStatus');
    if(db) {
      fbStatus.textContent = 'Firebase: configuré ✔︎';
      fbStatus.style.color = '#8be28b';
    } else {
      fbStatus.textContent = 'Firebase: non configuré ❌';
      fbStatus.style.color = '#e2a48b';
    }
  })();

  // Lecture de la base
  const res = document.getElementById('result');
  const input = document.getElementById('dateInput');
  const btn = document.getElementById('showBtn');
  const chk = document.getElementById('autoRefresh');
  let interval = null;

  function afficherVictime() {
    const date = input.value.trim();
    if(!date) return alert('Entrez une date au format AAAA-MM-JJ');
    res.textContent = 'Chargement...';
    db.ref('/nights/'+date+'/votes').once('value').then(snap => {
      const votes = snap.val();
      if(!votes) {
        res.textContent = 'Aucune élimination enregistrée pour cette nuit.';
        return;
      }
      const values = Object.values(votes);
      const last = values[values.length - 1];
      res.textContent = '✨ ' + last.victim + ' a été éliminé pendant la nuit.';
    }).catch(err => {
      res.textContent = 'Erreur: ' + err.message;
    });
  }

  btn.addEventListener('click', afficherVictime);
  chk.addEventListener('change', e => {
    if(e.target.checked) {
      interval = setInterval(afficherVictime, 10000);
    } else {
      clearInterval(interval);
    }
  });
  </script>
</body>
</html>
