<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Vote des Traîtres</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <style>
    body {
      background: #111;
      color: #fff;
      font-family: 'Cinzel', serif;
      text-align: center;
      margin: 0;
      padding: 48px 20px;
    }
    h1 { margin-bottom: 16px; }
    p { opacity: .9; }
    select, button {
      font-size: 18px;
      padding: 10px 12px;
      margin: 10px;
      border-radius: 10px;
      border: none;
    }
    select { min-width: 260px; }
    button {
      background: #c0392b;
      color: #fff;
      cursor: pointer;
      transition: transform .1s ease, opacity .2s ease, background .2s ease;
    }
    button:hover { background: #e74c3c; }
    button:active { transform: translateY(1px); }
    #message {
      margin-top: 18px;
      font-size: 18px;
      color: limegreen;
      opacity: 0;
      transition: opacity .4s ease;
    }
  </style>
</head>
<body>
  <h1>Vote des Traîtres</h1>
  <p>Sélectionne le joueur à éliminer :</p>

  <select id="victimSelect">
    <option value="">-- Choisir un joueur --</option>
    <option value="Aurélie">Aurélie</option>
    <option value="Arnaud">Arnaud</option>
    <option value="Sabrina">Sabrina</option>
    <option value="Thierry">Thierry</option>
    <option value="Sandrine">Sandrine</option>
    <option value="Anthony">Anthony</option>
    <option value="Julia">Julia</option>
    <option value="Sébastien">Sébastien</option>
    <option value="Coralie">Coralie</option>
    <option value="Bilou">Bilou</option>
    <option value="Stéphane">Stéphane</option>
    <option value="Franck">Franck</option>
  </select>
  <br />
  <button id="voteBtn">Envoyer le vote</button>
  <div id="message">Votre vote a bien été enregistré.</div>

  <script>
    // Config Firebase
    var firebaseConfig = {
      apiKey: "AIzaSyAu4zFpNXwSTSVsw4PZSZ4zKnIGejKRxFo",
      authDomain: "ans-de-franck.firebaseapp.com",
      databaseURL: "https://ans-de-franck-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "ans-de-franck",
      storageBucket: "ans-de-franck.firebasestorage.app",
      messagingSenderId: "1063437612417",
      appId: "1:1063437612417:web:812e847dfcd990c6922480"
    };
    try { if (!firebase.apps.length) firebase.initializeApp(firebaseConfig); } catch(e) {}

    const db = firebase.database();

    function todayKey() {
      const d = new Date();
      return d.getFullYear() + '-' +
        String(d.getMonth() + 1).padStart(2, '0') + '-' +
        String(d.getDate()).padStart(2, '0');
    }

    document.getElementById("voteBtn").addEventListener("click", () => {
      // normalise le nom choisi (évite les différences de casse)
      let victim = document.getElementById("victimSelect").value.trim();
      if (!victim) { alert("Choisis une personne avant de voter !"); return; }
      victim = victim.charAt(0).toUpperCase() + victim.slice(1).toLowerCase();

      const msg = document.getElementById("message");
      msg.style.opacity = 0;

      const ref = db.ref("nights/" + todayKey() + "/votes").push();
      ref.set({
        victim: victim,
        ts: Date.now(),
        ua: navigator.userAgent || ""
      })
      .then(() => {
        msg.textContent = "Votre vote a bien été enregistré.";
        msg.style.color = "limegreen";
        msg.style.opacity = 1;
      })
      .catch((error) => {
        console.error(error);
        msg.textContent = "Erreur : le vote n’a pas pu être enregistré.";
        msg.style.color = "red";
        msg.style.opacity = 1;
      });
    });
  </script>
</body>
</html>
